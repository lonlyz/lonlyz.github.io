import{_ as e,o,c as r,b as s,a as l,d as n,e as D,r as c}from"./app.2d179ac6.js";var t="/construct/mybatis/archtecture_diagram.jpg",i="/construct/mybatis/excution_diagram.png",p="/construct/mybatis/sqlsession_excutrion_diagram.png",y="/construct/mybatis/config_load_diagram.png",d="/construct/mybatis/mapper_load_diagram.png",C="/construct/mybatis/sqlsource_create_diagram.png",u="/construct/mybatis/sqlsession_excution_diagram_2.png",v="/construct/mybatis/get_boundsql_diagram.png",m="/construct/mybatis/param_mapping_diagram.png",b="/construct/mybatis/result_mapping_diagram.png";const A={},E=s("h1",{id:"mybatis\u6E90\u7801\u5206\u6790",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#mybatis\u6E90\u7801\u5206\u6790","aria-hidden":"true"},"#"),n(" Mybatis\u6E90\u7801\u5206\u6790")],-1),g={href:"https://www.cnblogs.com/angelica-duhurica/category/1489346.html",target:"_blank",rel:"noopener noreferrer"},h=n("mybatis\u6E90\u7801\u5206\u6790"),F=s("h2",{id:"_1-mybatis\u67B6\u6784\u5206\u6790",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_1-mybatis\u67B6\u6784\u5206\u6790","aria-hidden":"true"},"#"),n(" 1.mybatis\u67B6\u6784\u5206\u6790")],-1),q=s("h3",{id:"_1-1mybatis\u6846\u67B6\u67B6\u6784\u56FE",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_1-1mybatis\u6846\u67B6\u67B6\u6784\u56FE","aria-hidden":"true"},"#"),n(" 1.1mybatis\u6846\u67B6\u67B6\u6784\u56FE")],-1),B={href:"https://www.cnblogs.com/angelica-duhurica/p/11111821.html",target:"_blank",rel:"noopener noreferrer"},S=n("\u6846\u67B6\u67B6\u6784"),f=s("p",null,[s("img",{src:t,alt:"\u6846\u67B6\u67B6\u6784\u56FE"})],-1),x=s("p",null,"Mybatis\u7684\u529F\u80FD\u67B6\u6784\u5206\u4E3A\u4E09\u5C42\uFF1A",-1),_=s("ul",null,[s("li",null,"API\u63A5\u53E3\u5C42\uFF1A\u63D0\u4F9B\u7ED9\u5916\u90E8\u4F7F\u7528\u7684API\u63A5\u53E3\uFF0C\u5F00\u53D1\u4EBA\u5458\u901A\u8FC7\u8FD9\u4E9B\u672C\u5730\u7684API\u64CD\u7EB5\u6570\u636E\u5E93\u3002\u63A5\u53E3\u5C42\u4E00\u65E6\u6536\u5230\u8C03\u7528\u8BF7\u6C42\u5C31\u4F1A\u8C03\u7528\u6570\u636E\u5904\u7406\u5C42\u8FDB\u884C\u5177\u4F53\u7684\u6570\u636E\u5904\u7406\u3002"),s("li",null,"\u6570\u636E\u5904\u7406\u5C42\uFF1A\u8D1F\u8D23\u5177\u4F53\u7684SQL\u67E5\u627E\u3001SQL\u89E3\u6790\u3001SQL\u6267\u884C\u548C\u6267\u884C\u7ED3\u679C\u6620\u5C04\u7B49\u3002\u4E3B\u8981\u76EE\u7684\u662F\u6839\u636E\u8C03\u7528\u7684\u8BF7\u6C42\u5B8C\u6210\u4E00\u6B21\u6570\u636E\u5E93\u64CD\u4F5C\u3002"),s("li",null,"\u57FA\u7840\u652F\u6491\u5C42\uFF1A\u8D1F\u8D23\u6700\u57FA\u7840\u7684\u529F\u80FD\u652F\u6491\uFF0C\u5305\u62EC\u8FDE\u63A5\u7BA1\u7406\u3001\u4E8B\u52A1\u7BA1\u7406\u3001\u914D\u7F6E\u52A0\u8F7D\u548C\u7F13\u5B58\u7BA1\u7406\uFF0C\u8FD9\u4E9B\u90FD\u662F\u516C\u7528\u7684\u4E1C\u897F\uFF0C\u4E3A\u4E0A\u5C42\u63D0\u4F9B\u57FA\u7840\u652F\u6301\u3002")],-1),M=s("h3",{id:"_1-2\u6574\u4F53\u6267\u884C\u6D41\u7A0B\u56FE",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_1-2\u6574\u4F53\u6267\u884C\u6D41\u7A0B\u56FE","aria-hidden":"true"},"#"),n(" 1.2\u6574\u4F53\u6267\u884C\u6D41\u7A0B\u56FE")],-1),P={href:"https://www.cnblogs.com/angelica-duhurica/p/11111695.html",target:"_blank",rel:"noopener noreferrer"},L=n("\u6267\u884C\u6D41\u7A0B"),X=D('<p><img src="'+i+'" alt="\u6267\u884C\u6D41\u7A0B\u56FE"></p><p>\u6267\u884C\u6D41\u7A0B\uFF1A</p><ul><li>\u5165\u53E3\u4E3ASqlMapConfig.xml\u5168\u5C40\u914D\u7F6E\u6587\u4EF6\uFF0C\u914D\u7F6Emybatis\u7684\u8FD0\u884C\u73AF\u5883\u3002\u6B64\u5916sql\u8BED\u53E5\u7684\u6620\u5C04\u6587\u4EF6Mapper.xml\uFF0C\u6587\u4EF6\u4E2D\u914D\u7F6E\u4E86\u5177\u4F53\u6267\u884C\u7684sql\u8BED\u53E5\u3002\u8BE5\u6587\u4EF6\u9700\u8981\u5728SqlMapConfig.xml\u6587\u4EF6\u4E2D\u52A0\u8F7D\u3002</li><li>\u901A\u8FC7\u5168\u5C40\u914D\u7F6E\u6587\u4EF6\u6784\u9020SqlSessionFactory\u4F1A\u8BDD\u5DE5\u5382\u3002</li><li>\u901A\u8FC7\u4F1A\u8BDD\u5DE5\u5382\u521B\u5EFASqlSession\uFF0C\u5BF9\u6570\u636E\u5E93\u7684\u64CD\u4F5C\u63D0\u4F9B\u57FA\u7840\u3002</li><li>mybatis\u5E95\u5C42\u81EA\u5B9A\u4E49Executor\u6267\u884C\u5668\u63A5\u53E3\u8FDB\u884C\u6570\u636E\u5E93\u7684\u64CD\u4F5C\uFF0CExecutor\u6709\u4E24\u4E2A\u5B9E\u73B0\uFF0C\u4E00\u4E2A\u662F\u57FA\u672C\u6267\u884C\u5668\uFF0C\u4E00\u4E2A\u662F\u7F13\u5B58\u6267\u884C\u5668\u3002</li><li>MapppedStatement\u662Fmybatis\u5E95\u5C42\u7684\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u5305\u542B\u4E86mybatis\u7684\u914D\u7F6E\u4FE1\u606F\u548Csql\u6620\u5C04\u4FE1\u606F\u3002Mapper.xml\u6587\u4EF6\u4E00\u4E2Asql\u6807\u7B7E\u5BF9\u5E94\u4E00\u4E2AMappedStatement\u5BF9\u8C61\uFF0Csql\u6807\u7B7E\u7684id\u662FMappedStatement\u5BF9\u8C61\u7684id\u3002</li><li>MapppedStatement\u5BF9sql\u6267\u884C\u7684\u8F93\u5165\u53C2\u6570\u8FDB\u884C\u5B9A\u4E49\u3002</li><li>MapppedStatement\u5BF9sql\u6267\u884C\u7684\u7ED3\u679C\u8FDB\u884C\u5B9A\u4E8E\u3002</li></ul><h3 id="_1-3sqlsession\u6267\u884C\u6D41\u7A0B\u56FE" tabindex="-1"><a class="header-anchor" href="#_1-3sqlsession\u6267\u884C\u6D41\u7A0B\u56FE" aria-hidden="true">#</a> 1.3sqlsession\u6267\u884C\u6D41\u7A0B\u56FE</h3><p><img src="'+p+`" alt="sqlsession\u6267\u884C\u6D41\u7A0B\u56FE"></p><p>\u5C0F\u7ED3\uFF1A</p><p>\u200B \u5728SqlSession\u63A5\u53E3\u8C03\u7528\u7684insert/update/delete\u65B9\u6CD5\u4E2D\uFF0C\u6240\u6709\u7684\u64CD\u4F5C\u90FD\u4EA4\u7ED9\u4E86Executor\u6765\u64CD\u4F5C\u3002SqlSession\u63A5\u53E3\u662FMybatis\u6846\u67B6\u66B4\u9732\u7684\u5916\u90E8\u63A5\u53E3\uFF0C\u800CExecutor\u662F\u5185\u90E8\u7684\u5B9E\u73B0\u63A5\u53E3\u3002\u5728Executor\u7684\u5B9E\u73B0\u4E2D\uFF0C\u53C8\u662F\u8C03\u7528StatementHandler\u6765\u5904\u7406\u7684\u3002\u5F53\u7136\uFF0C\u5728\u8C03\u7528StatementHandler\u8BBE\u7F6E\u53C2\u6570\u65F6\u5019\uFF0C\u9700\u8981ParameterHandler\u6765\u8BBE\u7F6E\u76F8\u5E94\u7684\u53C2\u6570\u3002</p><h2 id="_2-mybatis\u6E90\u7801\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_2-mybatis\u6E90\u7801\u5206\u6790" aria-hidden="true">#</a> 2.mybatis\u6E90\u7801\u5206\u6790</h2><h3 id="_2-1config\u6587\u4EF6\u52A0\u8F7D\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#_2-1config\u6587\u4EF6\u52A0\u8F7D\u6D41\u7A0B" aria-hidden="true">#</a> 2.1config\u6587\u4EF6\u52A0\u8F7D\u6D41\u7A0B</h3><ul><li><p>\u52A0\u8F7Dmybatis\u5168\u5C40\u914D\u7F6E\u6587\u4EF6\uFF0C\u4F7F\u7528<strong>SqlSessionFactoryBuilder</strong>\u521B\u5EFA<strong>SqlSessionFactory</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">resource</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&quot;debug/config/mybatis-config.xml&quot;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#4EC9B0;">Reader</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">reader</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#6A9955;">// \u4F7F\u7528java.io.Reader\u6784\u5EFA</span></span>
<span class="line"><span style="color:#D4D4D4;">reader = </span><span style="color:#9CDCFE;">Resources</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getResourceAsReader</span><span style="color:#D4D4D4;">(resource);</span></span>
<span class="line"><span style="color:#4EC9B0;">SqlSessionFactory</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">sqlMapper</span><span style="color:#D4D4D4;"> = </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">SqlSessionFactoryBuilder</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">build</span><span style="color:#D4D4D4;">(reader);</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u5B9E\u4F8B\u5316<strong>XMLConfigBuilder</strong>\u5BF9\u8C61\u4F20\u5165mybatis\u7684\u5168\u5C40\u914D\u7F6E\u6587\u4EF6\uFF0C\u8FDB\u884Cmybatis\u914D\u7F6E\u6587\u4EF6\u7684\u89E3\u6790</p><p>org.apache.ibatis.session.SqlSessionFactoryBuilder#build(java.io.Reader, java.lang.String, java.util.Properties)</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">SqlSessionFactory</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">build</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">Reader</span><span style="color:#D4D4D4;"> reader, </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> environment, </span><span style="color:#4EC9B0;">Properties</span><span style="color:#D4D4D4;"> properties) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">       * \u89E3\u6790mybatis-config.xml   config\u8282\u70B9</span></span>
<span class="line"><span style="color:#6A9955;">       */</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#4EC9B0;">XMLConfigBuilder</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">parser</span><span style="color:#D4D4D4;"> = </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">XMLConfigBuilder</span><span style="color:#D4D4D4;">(reader, environment, properties);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">       * \u89E3\u6790mybatis-config.xml   mapper\u8282\u70B9 \u89E3\u6790*mapper.xml</span></span>
<span class="line"><span style="color:#6A9955;">       */</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">build</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">parser</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">parse</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">Exception</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">throw</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">ExceptionFactory</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">wrapException</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Error building SqlSession.&quot;</span><span style="color:#D4D4D4;">, e);</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">finally</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">ErrorContext</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">instance</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">reset</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">reader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">close</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">      } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">IOException</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">// Intentionally ignore. Prefer previous error.</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u5B9E\u4F8B\u5316<strong>XMLConfigBuilder</strong>\u5BF9\u8C61\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u521B\u5EFA\u6587\u6863\u89E3\u6790\u5668</p><p>org.apache.ibatis.builder.xml.XMLConfigBuilder#XMLConfigBuilder(java.io.Reader, java.lang.String, java.util.Properties)</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">   *</span></span>
<span class="line"><span style="color:#6A9955;">   * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">reader</span><span style="color:#6A9955;"> \u914D\u7F6E\u6587\u4EF6\u7684\u5B57\u7B26\u6D41</span></span>
<span class="line"><span style="color:#6A9955;">   * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">environment</span><span style="color:#6A9955;"> \u73AF\u5883\u53C2\u6570</span></span>
<span class="line"><span style="color:#6A9955;">   * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">props</span><span style="color:#6A9955;"> \u53C2\u6570</span></span>
<span class="line"><span style="color:#6A9955;">   */</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">XMLConfigBuilder</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">Reader</span><span style="color:#D4D4D4;"> reader, </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> environment, </span><span style="color:#4EC9B0;">Properties</span><span style="color:#D4D4D4;"> props) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">this</span><span style="color:#D4D4D4;">(</span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">XPathParser</span><span style="color:#D4D4D4;">(reader, </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">, props, </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">XMLMapperEntityResolver</span><span style="color:#D4D4D4;">()), environment, props);</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>org.apache.ibatis.builder.xml.XMLConfigBuilder#XMLConfigBuilder(org.apache.ibatis.parsing.XPathParser, java.lang.String, java.util.Properties)</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">   * \u4E3B\u8981\u662F\u6839\u636Emybatis\u81EA\u8EAB\u9700\u8981\u521B\u5EFA\u4E00\u4E2A\u6587\u6863\u89E3\u6790\u5668\uFF0C\u7136\u540E\u8C03\u7528parse\u5C06\u8F93\u5165input source\u89E3\u6790\u4E3ADOM XML\u6587\u6863\u5E76\u8FD4\u56DE\u3002</span></span>
<span class="line"><span style="color:#6A9955;">   * \u5F97\u5230XPathParser\u5B9E\u4F8B\u4E4B\u540E\uFF0C\u5C31\u8C03\u7528\u53E6\u4E00\u4E2A\u4F7F\u7528XPathParser\u4F5C\u4E3A\u914D\u7F6E\u6765\u6E90\u7684\u91CD\u8F7D\u6784\u9020\u51FD\u6570\u4E86</span></span>
<span class="line"><span style="color:#6A9955;">   * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">parser</span></span>
<span class="line"><span style="color:#6A9955;">   * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">environment</span></span>
<span class="line"><span style="color:#6A9955;">   * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">props</span></span>
<span class="line"><span style="color:#6A9955;">   */</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">XMLConfigBuilder</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">XPathParser</span><span style="color:#D4D4D4;"> parser, </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> environment, </span><span style="color:#4EC9B0;">Properties</span><span style="color:#D4D4D4;"> props) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">//\u4E3B\u8981\u662F\u8BBE\u7F6E\u7C7B\u578B\u522B\u540D\u6CE8\u518C\u5668\uFF0C\u4EE5\u53CA\u7C7B\u578B\u5904\u7406\u5668\u6CE8\u518C\u5668</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">super</span><span style="color:#D4D4D4;">(</span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">Configuration</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">ErrorContext</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">instance</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">resource</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;SQL Mapper Configuration&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">this</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">configuration</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setVariables</span><span style="color:#D4D4D4;">(props);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">this</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">parsed</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">false</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">this</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">environment</span><span style="color:#D4D4D4;"> = environment;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">this</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">parser</span><span style="color:#D4D4D4;"> = parser;</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>XPathParser**\u4F7F\u7528\u7684createDocument\u65B9\u6CD5\u6765\u5C06DOM\u52A0\u8F7D\u5230XPathParser\u4E2D</p><p>org.apache.ibatis.parsing.XPathParser#XPathParser(java.io.Reader, boolean, java.util.Properties, org.xml.sax.EntityResolver)</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">XPathParser</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">Reader</span><span style="color:#D4D4D4;"> reader, </span><span style="color:#4EC9B0;">boolean</span><span style="color:#D4D4D4;"> validation, </span><span style="color:#4EC9B0;">Properties</span><span style="color:#D4D4D4;"> variables, </span><span style="color:#4EC9B0;">EntityResolver</span><span style="color:#D4D4D4;"> entityResolver) {</span></span>
<span class="line"><span style="color:#D4D4D4;">     </span><span style="color:#6A9955;">// entityResolver  \u4E0A\u4E00\u6B65\u5B9E\u4F8B\u7684XMLMapperEntityResolver</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">commonConstructor</span><span style="color:#D4D4D4;">(validation, variables, entityResolver);</span></span>
<span class="line"><span style="color:#D4D4D4;">     </span><span style="color:#6A9955;">//\u52A0\u8F7Ddom\u5143\u7D20\u5230XPathParser</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">this</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">createDocument</span><span style="color:#D4D4D4;">(</span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">InputSource</span><span style="color:#D4D4D4;">(reader));</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>org.apache.ibatis.parsing.XPathParser#createDocument</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Document</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">createDocument</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">InputSource</span><span style="color:#D4D4D4;"> inputSource) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// important: this must only be called AFTER common constructor</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#4EC9B0;">DocumentBuilderFactory</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">factory</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">DocumentBuilderFactory</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">newInstance</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">factory</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setValidating</span><span style="color:#D4D4D4;">(validation);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">//\u8BBE\u7F6E\u7531\u672C\u5DE5\u5382\u521B\u5EFA\u7684\u89E3\u6790\u5668\u662F\u5426\u652F\u6301XML\u547D\u540D\u7A7A\u95F4 true \u652F\u6301 false \u4E0D\u652F\u6301</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">factory</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setNamespaceAware</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">false</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">factory</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setIgnoringComments</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// \u662F\u5426\u5728\u89E3\u6790\u7684\u65F6\u5019\u6D88\u9664\u7A7A\u683C</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">factory</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setIgnoringElementContentWhitespace</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">false</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">//\u8BBE\u7F6E\u662F\u5426\u5C06CDATA\u8282\u70B9\u8F6C\u6362\u4E3AText\u8282\u70B9</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">factory</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setCoalescing</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">false</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">//\u8BBE\u7F6E\u662F\u5426\u5C55\u5F00\u5B9E\u4F53\u5F15\u7528\u8282\u70B9\uFF0C\u8FD9\u91CC\u5E94\u8BE5\u662Fsql\u7247\u6BB5\u5F15\u7528\u7684\u5173\u952E</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">factory</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setExpandEntityReferences</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#4EC9B0;">DocumentBuilder</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">builder</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">factory</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">newDocumentBuilder</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">//\u8BBE\u7F6E\u89E3\u6790mybatis xml\u6587\u6863\u8282\u70B9\u7684\u89E3\u6790\u5668,\u4E5F\u5C31\u662F\u4E0A\u9762\u7684XMLMapperEntityResolver</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">builder</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setEntityResolver</span><span style="color:#D4D4D4;">(entityResolver);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">builder</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setErrorHandler</span><span style="color:#D4D4D4;">(</span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">ErrorHandler</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">        @</span><span style="color:#4EC9B0;">Override</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">error</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">SAXParseException</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">exception</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">throws</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">SAXException</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#C586C0;">throw</span><span style="color:#D4D4D4;"> exception;</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">        @</span><span style="color:#4EC9B0;">Override</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">fatalError</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">SAXParseException</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">exception</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">throws</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">SAXException</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#C586C0;">throw</span><span style="color:#D4D4D4;"> exception;</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">        @</span><span style="color:#4EC9B0;">Override</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">warning</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">SAXParseException</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">exception</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">throws</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">SAXException</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;">      });</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">//\u52A0\u8F7D\u5B8C\u6210dom\u5143\u7D20</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">builder</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">parse</span><span style="color:#D4D4D4;">(inputSource);</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">Exception</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">throw</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">BuilderException</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Error creating document instance.  Cause: &quot;</span><span style="color:#D4D4D4;"> + e, e);</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>SqlSessionFactoryBuilder</strong>\u4E2Dbuilder()\u65B9\u6CD5\u7684parser.parse()\u65B9\u6CD5,\u8FDB\u884C\u5B9E\u9645\u7684\u89E3\u6790\u5168\u5C40\u914D\u7F6E\u6587\u4EF6</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">SqlSessionFactory</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">build</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">Reader</span><span style="color:#D4D4D4;"> reader, </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> environment, </span><span style="color:#4EC9B0;">Properties</span><span style="color:#D4D4D4;"> properties) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">       * \u89E3\u6790mybatis-config.xml   config\u8282\u70B9</span></span>
<span class="line"><span style="color:#6A9955;">       */</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#4EC9B0;">XMLConfigBuilder</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">parser</span><span style="color:#D4D4D4;"> = </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">XMLConfigBuilder</span><span style="color:#D4D4D4;">(reader, environment, properties);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">       * \u89E3\u6790mybatis-config.xml   mapper\u8282\u70B9 \u89E3\u6790*mapper.xml</span></span>
<span class="line"><span style="color:#6A9955;">       */</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">build</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">parser</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">parse</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">Exception</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">throw</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">ExceptionFactory</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">wrapException</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Error building SqlSession.&quot;</span><span style="color:#D4D4D4;">, e);</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">finally</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">ErrorContext</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">instance</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">reset</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">reader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">close</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">      } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">IOException</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">// Intentionally ignore. Prefer previous error.</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>org.apache.ibatis.builder.xml.XMLConfigBuilder#parse</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;">//\u771F\u6B63Configuration\u6784\u5EFA\u903B\u8F91</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Configuration</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">parse</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (parsed) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">throw</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">BuilderException</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Each XMLConfigBuilder can only be used once.&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">    parsed = </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">//mybatis\u914D\u7F6E\u6587\u4EF6\u89E3\u6790\u7684\u4E3B\u6D41\u7A0B</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">parseConfiguration</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">parser</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;/configuration&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> configuration;</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>org.apache.ibatis.builder.xml.XMLConfigBuilder#parseConfiguration</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">   * \u89E3\u6790mybatis-config.xml\u6587\u4EF6</span></span>
<span class="line"><span style="color:#6A9955;">   * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">root</span></span>
<span class="line"><span style="color:#6A9955;">   */</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">parseConfiguration</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">XNode</span><span style="color:#D4D4D4;"> root) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">//issue #117 read properties first</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">propertiesElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;properties&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#4EC9B0;">Properties</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">settings</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">settingsAsProperties</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;settings&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// \u52A0\u8F7D\u81EA\u5B9A\u4E49\u7684vfs jbossvfs defaultvfs</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">loadCustomVfs</span><span style="color:#D4D4D4;">(settings);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">loadCustomLogImpl</span><span style="color:#D4D4D4;">(settings);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">//\u89E3\u6790\u7C7B\u578B\u522B\u540D</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">typeAliasesElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;typeAliases&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">//\u52A0\u8F7D\u63D2\u4EF6</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">pluginElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;plugins&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">       * \u6BCF\u6B21\u521B\u5EFA\u7ED3\u679C\u5BF9\u8C61\u7684\u65B0\u5B9E\u4F8B\u65F6\uFF0C\u5B83\u90FD\u4F1A\u4F7F\u7528\u4E00\u4E2A\u5BF9\u8C61\u5DE5\u5382\uFF08ObjectFactory\uFF09\u5B9E\u4F8B\u6765\u5B8C\u6210</span></span>
<span class="line"><span style="color:#6A9955;">       *  \u9ED8\u8BA4\u7684\u5BF9\u8C61\u5DE5\u5382\u9700\u8981\u505A\u7684\u4EC5\u4EC5\u662F\u5B9E\u4F8B\u5316\u76EE\u6807\u7C7B\uFF0C\u8981\u4E48\u901A\u8FC7\u9ED8\u8BA4\u6784\u9020\u65B9\u6CD5\uFF0C\u8981\u4E48\u5728\u53C2\u6570\u6620\u5C04\u5B58\u5728\u7684\u65F6\u5019\u901A\u8FC7\u53C2\u6570\u6784\u9020\u65B9\u6CD5\u6765\u5B9E\u4F8B\u5316\u3002</span></span>
<span class="line"><span style="color:#6A9955;">       *  \u5982\u679C\u60F3\u8986\u76D6\u5BF9\u8C61\u5DE5\u5382\u7684\u9ED8\u8BA4\u884C\u4E3A\uFF0C\u5219\u53EF\u4EE5\u901A\u8FC7\u521B\u5EFA\u81EA\u5DF1\u7684\u5BF9\u8C61\u5DE5\u5382\u6765\u5B9E\u73B0</span></span>
<span class="line"><span style="color:#6A9955;">       *  setProperties \u65B9\u6CD5\u53EF\u4EE5\u88AB\u7528\u6765\u914D\u7F6E ObjectFactory\uFF0C\u5728\u521D\u59CB\u5316\u4F60\u7684 ObjectFactory \u5B9E\u4F8B\u540E\uFF0CobjectFactory\u5143\u7D20\u4F53\u4E2D\u5B9A\u4E49\u7684\u5C5E\u6027\u4F1A\u88AB\u4F20\u9012\u7ED9setProperties\u65B9\u6CD5</span></span>
<span class="line"><span style="color:#6A9955;">       *</span></span>
<span class="line"><span style="color:#6A9955;">       * @see &lt;a href=&#39;http://www.mybatis.org/mybatis-3/zh/configuration.html#objectFactory&#39;&gt;\u5BF9\u8C61\u5DE5\u5382\uFF08ObjectFactory\uFF09&lt;/a&gt;</span></span>
<span class="line"><span style="color:#6A9955;">       */</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">objectFactoryElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;objectFactory&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">       * \u5BF9\u8C61\u5305\u88C5\u5668\u5DE5\u5382\u4E3B\u8981\u7528\u6765\u5305\u88C5\u8FD4\u56DEresult\u5BF9\u8C61\uFF0C\u6BD4\u5982\u8BF4\u53EF\u4EE5\u7528\u6765\u8BBE\u7F6E\u67D0\u4E9B\u654F\u611F\u5B57\u6BB5\u8131\u654F\u6216\u8005\u52A0\u5BC6\u7B49\u3002</span></span>
<span class="line"><span style="color:#6A9955;">       * \u9ED8\u8BA4\u5BF9\u8C61\u5305\u88C5\u5668\u5DE5\u5382\u662FDefaultObjectWrapperFactory\uFF0C\u4E5F\u5C31\u662F\u4E0D\u4F7F\u7528\u5305\u88C5\u5668\u5DE5\u5382</span></span>
<span class="line"><span style="color:#6A9955;">       */</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">objectWrapperFactoryElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;objectWrapperFactory&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">       * \u56E0\u4E3A\u52A0\u8F7D\u914D\u7F6E\u6587\u4EF6\u4E2D\u7684\u5404\u79CD\u63D2\u4EF6\u7C7B\u7B49\u7B49\uFF0C\u4E3A\u4E86\u63D0\u4F9B\u66F4\u597D\u7684\u7075\u6D3B\u6027\uFF0Cmybatis\u652F\u6301\u7528\u6237\u81EA\u5B9A\u4E49\u53CD\u5C04\u5DE5\u5382\uFF0C\u4E0D\u8FC7\u603B\u4F53\u6765\u8BF4\uFF0C\u7528\u7684\u4E0D\u591A\uFF0C\u8981\u5B9E\u73B0\u53CD\u5C04\u5DE5\u5382\uFF0C\u53EA\u8981\u5B9E\u73B0ReflectorFactory\u63A5\u53E3\u5373\u53EF\u3002</span></span>
<span class="line"><span style="color:#6A9955;">       * \u9ED8\u8BA4\u7684\u53CD\u5C04\u5DE5\u5382\u662FDefaultReflectorFactory\u3002\u4E00\u822C\u6765\u8BF4\uFF0C\u4F7F\u7528\u9ED8\u8BA4\u7684\u53CD\u5C04\u5DE5\u5382\u5C31\u53EF\u4EE5\u4E86</span></span>
<span class="line"><span style="color:#6A9955;">       */</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">reflectorFactoryElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;reflectorFactory&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">settingsElement</span><span style="color:#D4D4D4;">(settings);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// read it after objectFactory and objectWrapperFactory issue #631</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">       * \u73AF\u5883\u53EF\u4EE5\u8BF4\u662Fmybatis-config\u914D\u7F6E\u6587\u4EF6\u4E2D\u6700\u91CD\u8981\u7684\u90E8\u5206\uFF0C\u5B83\u7C7B\u4F3C\u4E8Espring\u548Cmaven\u91CC\u9762\u7684profile\uFF0C\u5141\u8BB8\u7ED9\u5F00\u53D1\u3001\u751F\u4EA7\u73AF\u5883\u540C\u65F6\u914D\u7F6E\u4E0D\u540C\u7684environment\uFF0C\u6839\u636E\u4E0D\u540C\u7684\u73AF\u5883\u52A0\u8F7D\u4E0D\u540C\u7684\u914D\u7F6E\uFF0C\u8FD9\u4E5F\u662F\u5E38\u89C1\u7684\u505A\u6CD5\uFF0C</span></span>
<span class="line"><span style="color:#6A9955;">       * \u5982\u679C\u5728SqlSessionFactoryBuilder\u8C03\u7528\u671F\u95F4\u6CA1\u6709\u4F20\u9012\u4F7F\u7528\u54EA\u4E2A\u73AF\u5883\u7684\u8BDD\uFF0C\u9ED8\u8BA4\u4F1A\u4F7F\u7528\u4E00\u4E2A\u540D\u4E3Adefault\u201D\u7684\u73AF\u5883\u3002</span></span>
<span class="line"><span style="color:#6A9955;">       * \u627E\u5230\u5BF9\u5E94\u7684environment\u4E4B\u540E\uFF0C\u5C31\u53EF\u4EE5\u52A0\u8F7D\u4E8B\u52A1\u7BA1\u7406\u5668\u548C\u6570\u636E\u6E90\u4E86\u3002</span></span>
<span class="line"><span style="color:#6A9955;">       * \u4E8B\u52A1\u7BA1\u7406\u5668\u548C\u6570\u636E\u6E90\u7C7B\u578B\u8FD9\u91CC\u90FD\u7528\u5230\u4E86\u7C7B\u578B\u522B\u540D\uFF0CJDBC/POOLED\u90FD\u662F\u5728mybatis\u5185\u7F6E\u63D0\u4F9B\u7684\uFF0C\u5728Configuration\u6784\u9020\u5668\u6267\u884C\u671F\u95F4\u6CE8\u518C\u5230TypeAliasRegister\u3002</span></span>
<span class="line"><span style="color:#6A9955;">       * mybatis\u5185\u7F6E\u63D0\u4F9BJDBC\u548CMANAGED\u4E24\u79CD\u4E8B\u52A1\u7BA1\u7406\u65B9\u5F0F\uFF0C\u524D\u8005\u4E3B\u8981\u7528\u4E8E\u7B80\u5355JDBC\u6A21\u5F0F\uFF0C\u540E\u8005\u4E3B\u8981\u7528\u4E8E\u5BB9\u5668\u7BA1\u7406\u4E8B\u52A1\uFF0C\u4E00\u822C\u4F7F\u7528JDBC\u4E8B\u52A1\u7BA1\u7406\u65B9\u5F0F\u3002</span></span>
<span class="line"><span style="color:#6A9955;">       * mybatis\u5185\u7F6E\u63D0\u4F9BJNDI\u3001POOLED\u3001UNPOOLED\u4E09\u79CD\u6570\u636E\u6E90\u5DE5\u5382\uFF0C\u4E00\u822C\u60C5\u51B5\u4E0B\u4F7F\u7528POOLED\u6570\u636E\u6E90\u3002</span></span>
<span class="line"><span style="color:#6A9955;">       */</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">environmentsElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;environments&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">       * MyBatis \u4F1A\u52A0\u8F7D\u4E0D\u5E26 databaseId \u5C5E\u6027\u548C\u5E26\u6709\u5339\u914D\u5F53\u524D\u6570\u636E\u5E93 databaseId \u5C5E\u6027\u7684\u6240\u6709\u8BED\u53E5\u3002</span></span>
<span class="line"><span style="color:#6A9955;">       * \u5982\u679C\u540C\u65F6\u627E\u5230\u5E26\u6709 databaseId \u548C\u4E0D\u5E26 databaseId \u7684\u76F8\u540C\u8BED\u53E5\uFF0C\u5219\u540E\u8005\u4F1A\u88AB\u820D\u5F03\u3002</span></span>
<span class="line"><span style="color:#6A9955;">       */</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">databaseIdProviderElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;databaseIdProvider&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">       *\u65E0\u8BBA\u662F MyBatis \u5728\u9884\u5904\u7406\u8BED\u53E5\uFF08PreparedStatement\uFF09\u4E2D\u8BBE\u7F6E\u4E00\u4E2A\u53C2\u6570\u65F6\uFF0C\u8FD8\u662F\u4ECE\u7ED3\u679C\u96C6\u4E2D\u53D6\u51FA\u4E00\u4E2A\u503C\u65F6\uFF0C \u90FD\u4F1A\u7528\u7C7B\u578B\u5904\u7406\u5668\u5C06\u83B7\u53D6\u7684\u503C\u4EE5\u5408\u9002\u7684\u65B9\u5F0F\u8F6C\u6362\u6210 Java \u7C7B\u578B\u3002</span></span>
<span class="line"><span style="color:#6A9955;">       * mybatis\u63D0\u4F9B\u4E86\u4E24\u79CD\u65B9\u5F0F\u6CE8\u518C\u7C7B\u578B\u5904\u7406\u5668\uFF0Cpackage\u81EA\u52A8\u68C0\u7D22\u65B9\u5F0F\u548C\u663E\u793A\u5B9A\u4E49\u65B9\u5F0F\u3002\u4F7F\u7528\u81EA\u52A8\u68C0\u7D22\uFF08autodiscovery\uFF09\u529F\u80FD\u7684\u65F6\u5019\uFF0C\u53EA\u80FD\u901A\u8FC7\u6CE8\u89E3\u65B9\u5F0F\u6765\u6307\u5B9A JDBC \u7684\u7C7B\u578B\u3002</span></span>
<span class="line"><span style="color:#6A9955;">       * \u4E3A\u4E86\u7B80\u5316\u4F7F\u7528\uFF0Cmybatis\u5728\u521D\u59CB\u5316TypeHandlerRegistry\u671F\u95F4\uFF0C\u81EA\u52A8\u6CE8\u518C\u4E86\u5927\u90E8\u5206\u7684\u5E38\u7528\u7684\u7C7B\u578B\u5904\u7406\u5668\u6BD4\u5982\u5B57\u7B26\u4E32\u3001\u6570\u5B57\u3001\u65E5\u671F\u7B49\u3002\u5BF9\u4E8E\u975E\u6807\u51C6\u7684\u7C7B\u578B\uFF0C\u7528\u6237\u53EF\u4EE5\u81EA\u5B9A\u4E49\u7C7B\u578B\u5904\u7406\u5668\u6765\u5904\u7406\u3002\u8981\u5B9E\u73B0\u4E00\u4E2A\u81EA\u5B9A\u4E49\u7C7B\u578B\u5904\u7406\u5668\uFF0C\u53EA\u8981\u5B9E\u73B0 org.apache.ibatis.type.TypeHandler \u63A5\u53E3\uFF0C \u6216\u7EE7\u627F\u4E00\u4E2A\u5B9E\u7528\u7C7B org.apache.ibatis.type.BaseTypeHandler\uFF0C \u5E76\u5C06\u5B83\u6620\u5C04\u5230\u4E00\u4E2A JDBC \u7C7B\u578B\u5373\u53EF\u3002</span></span>
<span class="line"><span style="color:#6A9955;">       * &lt;a href=&#39;https://www.cnblogs.com/zhjh256/p/8512392.html#2.1.11-%E5%8A%A0%E8%BD%BD%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86%E5%99%A8typehandlerelement&#39;&gt;\u7C7B\u578B\u5904\u7406\u5668&lt;/a&gt;</span></span>
<span class="line"><span style="color:#6A9955;">       */</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">typeHandlerElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;typeHandlers&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">       * &lt;a href=&#39;https://www.cnblogs.com/zhjh256/p/8512392.html#2.1.12-%E5%8A%A0%E8%BD%BDmapper%E6%96%87%E4%BB%B6mapperelement&#39;&gt;\u52A0\u8F7Dmapper\u6587\u4EF6&lt;/a&gt;</span></span>
<span class="line"><span style="color:#6A9955;">       */</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">mapperElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;mappers&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">Exception</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">throw</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">BuilderException</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Error parsing SQL Mapper Configuration. Cause: &quot;</span><span style="color:#D4D4D4;"> + e, e);</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>\u603B\u7ED3\uFF1A</p><p><img src="`+y+`" alt="\u52A0\u8F7D\u6D41\u7A0B\u56FE"></p><h3 id="_2-2mapper\u6587\u4EF6\u52A0\u8F7D\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#_2-2mapper\u6587\u4EF6\u52A0\u8F7D\u6D41\u7A0B" aria-hidden="true">#</a> 2.2mapper\u6587\u4EF6\u52A0\u8F7D\u6D41\u7A0B</h3><ul><li><p>\u89E3\u6790\u5168\u5C40\u914D\u7F6E\u6587\u4EF6</p><p>org.apache.ibatis.builder.xml.XMLConfigBuilder#parseConfiguration</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">parseConfiguration</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">XNode</span><span style="color:#D4D4D4;"> root) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">     ...</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">//\u52A0\u8F7Dmybatis.config\u7684&lt;mappers&gt;\u6807\u7B7E</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">mapperElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;mappers&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">Exception</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">throw</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">BuilderException</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Error parsing SQL Mapper Configuration. Cause: &quot;</span><span style="color:#D4D4D4;"> + e, e);</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>org.apache.ibatis.builder.xml.XMLConfigBuilder#mapperElement</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">mapperElement</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">XNode</span><span style="color:#D4D4D4;"> parent) throws Exception {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (parent != </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">XNode</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">child</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">:</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">parent</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getChildren</span><span style="color:#D4D4D4;">()) {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">         * \u5982\u679C\u8981\u540C\u65F6\u4F7F\u7528package\u81EA\u52A8\u626B\u63CF\u548C\u901A\u8FC7mapper\u660E\u786E\u6307\u5B9A\u8981\u52A0\u8F7D\u7684mapper\uFF0C\u4E00\u5B9A\u8981\u786E\u4FDDpackage\u81EA\u52A8\u626B\u63CF\u7684\u8303\u56F4\u4E0D\u5305\u542B\u660E\u786E\u6307\u5B9A\u7684mapper\uFF0C</span></span>
<span class="line"><span style="color:#6A9955;">         * \u5426\u5219\u5728\u901A\u8FC7package\u626B\u63CF\u7684interface\u7684\u65F6\u5019\uFF0C\u5C1D\u8BD5\u52A0\u8F7D\u5BF9\u5E94xml\u6587\u4EF6\u7684loadXmlResource()\u7684\u903B\u8F91\u4E2D\u51FA\u73B0\u5224\u91CD\u51FA\u9519\uFF0C\u62A5org.apache.ibatis.binding.BindingException\u5F02\u5E38\uFF0C</span></span>
<span class="line"><span style="color:#6A9955;">         * \u5373\u4F7Fxml\u6587\u4EF6\u4E2D\u5305\u542B\u7684\u5185\u5BB9\u548Cmapper\u63A5\u53E3\u4E2D\u5305\u542B\u7684\u8BED\u53E5\u4E0D\u91CD\u590D\u4E5F\u4F1A\u51FA\u9519\uFF0C\u5305\u62EC\u52A0\u8F7Dmapper\u63A5\u53E3\u65F6\u81EA\u52A8\u52A0\u8F7D\u7684xml mapper\u4E5F\u4E00\u6837\u4F1A\u51FA\u9519\u3002</span></span>
<span class="line"><span style="color:#6A9955;">         */</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#CE9178;">&quot;package&quot;</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">equals</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">child</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getName</span><span style="color:#D4D4D4;">())) {</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">mapperPackage</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">child</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;name&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#9CDCFE;">configuration</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addMappers</span><span style="color:#D4D4D4;">(mapperPackage);</span></span>
<span class="line"><span style="color:#D4D4D4;">        } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">resource</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">child</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;resource&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">url</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">child</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;url&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">mapperClass</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">child</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;class&quot;</span><span style="color:#D4D4D4;">);     </span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (resource != </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> &amp;&amp; url == </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> &amp;&amp; mapperClass == </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#6A9955;">//mapper\u6807\u7B7E\u8BBE\u7F6E\u7684resource</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">ErrorContext</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">instance</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">resource</span><span style="color:#D4D4D4;">(resource);</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#4EC9B0;">InputStream</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">inputStream</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">Resources</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getResourceAsStream</span><span style="color:#D4D4D4;">(resource);</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#4EC9B0;">XMLMapperBuilder</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">mapperParser</span><span style="color:#D4D4D4;"> = </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">XMLMapperBuilder</span><span style="color:#D4D4D4;">(inputStream, configuration, resource, </span><span style="color:#9CDCFE;">configuration</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getSqlFragments</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">mapperParser</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">parse</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">          } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (resource == </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> &amp;&amp; url != </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> &amp;&amp; mapperClass == </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">              </span><span style="color:#6A9955;">//mapper\u6807\u7B7E\u8BBE\u7F6E\u7684url</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">ErrorContext</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">instance</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">resource</span><span style="color:#D4D4D4;">(url);</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#4EC9B0;">InputStream</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">inputStream</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">Resources</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getUrlAsStream</span><span style="color:#D4D4D4;">(url);</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#4EC9B0;">XMLMapperBuilder</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">mapperParser</span><span style="color:#D4D4D4;"> = </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">XMLMapperBuilder</span><span style="color:#D4D4D4;">(inputStream, configuration, url, </span><span style="color:#9CDCFE;">configuration</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getSqlFragments</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">mapperParser</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">parse</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">          } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (resource == </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> &amp;&amp; url == </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> &amp;&amp; mapperClass != </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#6A9955;">//mapper\u6807\u7B7E\u8BBE\u7F6E\u7684class\uFF0C\u5148\u8FDB\u884C\u6CE8\u89E3\u65B9\u5F0F\u7684\u52A0\u8F7D\uFF0C\u7136\u540E\u5728\u52A0\u8F7Dxml</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#4EC9B0;">Class</span><span style="color:#D4D4D4;">&lt;</span><span style="color:#569CD6;">?</span><span style="color:#D4D4D4;">&gt; </span><span style="color:#9CDCFE;">mapperInterface</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">Resources</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">classForName</span><span style="color:#D4D4D4;">(mapperClass);</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">configuration</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addMapper</span><span style="color:#D4D4D4;">(mapperInterface);</span></span>
<span class="line"><span style="color:#D4D4D4;">          } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">throw</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">BuilderException</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;A mapper element may only specify a url, resource or class, but not more than one.&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">          }</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>XMLMapperBuilder</strong>\u7684parse()\u65B9\u6CD5\u89E3\u6790mapper.xml</p><p>org.apache.ibatis.builder.xml.XMLMapperBuilder#parse</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">parse</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">//\u5224\u65ADconfiguration\u5BF9\u8C61\u662F\u5426\u52A0\u8F7Dxml\u6587\u4EF6\uFF0C\u907F\u514D\u91CD\u590D\u52A0\u8F7D\u7684\u95EE\u9898</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (!</span><span style="color:#9CDCFE;">configuration</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">isResourceLoaded</span><span style="color:#D4D4D4;">(resource)) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">//\u89E3\u6790mapper\u6807\u7B7E</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">configurationElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">parser</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;/mapper&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">configuration</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addLoadedResource</span><span style="color:#D4D4D4;">(resource);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">//\u5C06mapperClass\u6DFB\u52A0\u5230configuration\u4E2D</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">bindMapperForNamespace</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">//\u89E3\u6790\u5728configurationElement\u5904\u7406resultMap\u65F6\uFF0C\u5176extends\u5C5E\u6027\u6307\u5411\u7684\u7236\u5BF9\u8C61\u8FD8\u6CA1\u88AB\u5904\u7406\u7684resultMap\u8282\u70B9</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">parsePendingResultMaps</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">//\u89E3\u6790\u5728configurationElement\u5904\u7406&lt;cache-ref&gt;\u65F6\u5176\u6307\u5411\u7684\u5BF9\u8C61\u4E0D\u5B58\u5728\u7684&lt;cache&gt;\u8282\u70B9---\u5982\u679C&lt;cache-ref&gt;\u4F18\u5148\u4E8E&lt;cache&gt;\u52A0\u8F7D</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">parsePendingCacheRefs</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">//\u540C\u4E0A\uFF0C\u5982\u679C&lt;cache&gt;\u6CA1\u52A0\u8F7D\u5C31\u5904\u7406statement\u65F6\u4F1A\u62A5\u5F02\u5E38</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">parsePendingStatements</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>org.apache.ibatis.builder.xml.XMLMapperBuilder#configurationElement</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">configurationElement</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">XNode</span><span style="color:#D4D4D4;"> context) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">namespace</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;namespace&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (namespace == </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> || </span><span style="color:#9CDCFE;">namespace</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">equals</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;&quot;</span><span style="color:#D4D4D4;">)) {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">throw</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">BuilderException</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Mapper&#39;s namespace cannot be empty&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">builderAssistant</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setCurrentNamespace</span><span style="color:#D4D4D4;">(namespace);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">cacheRefElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;cache-ref&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">cacheElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;cache&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">parameterMapElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNodes</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;/mapper/parameterMap&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">resultMapElements</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNodes</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;/mapper/resultMap&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">sqlElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNodes</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;/mapper/sql&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">//\u8FDB\u884Csql\u8BED\u53E5\u7684\u5904\u7406\u5E76\u5C01\u88C5\u6210MappedStatement</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">buildStatementFromContext</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNodes</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;select|insert|update|delete&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">Exception</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">throw</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">BuilderException</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Error parsing Mapper XML. The XML location is &#39;&quot;</span><span style="color:#D4D4D4;"> + resource + </span><span style="color:#CE9178;">&quot;&#39;. Cause: &quot;</span><span style="color:#D4D4D4;"> + e, e);</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>\u603B\u7ED3\uFF1A</p><p><img src="`+d+`" alt="mapper\u6587\u4EF6\u52A0\u8F7D\u8FC7\u7A0B"></p><h3 id="_2-3sqlsource\u521B\u5EFA\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#_2-3sqlsource\u521B\u5EFA\u6D41\u7A0B" aria-hidden="true">#</a> 2.3sqlsource\u521B\u5EFA\u6D41\u7A0B</h3><ul><li><p>\u5728\u89E3\u6790\u5177\u4F53sql\u7684XmlStatementBuilder\u7C7B\u4E2Dorg.apache.ibatis.builder.xml.XMLStatementBuilder#parseStatementNode</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">   * \u5BF9mapper.xml\u6587\u4EF6\u7684sql\u8BED\u53E5\u8FDB\u884C\u89E3\u6790</span></span>
<span class="line"><span style="color:#6A9955;">   */</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">parseStatementNode</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">id</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;id&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">databaseId</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;databaseId&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (!</span><span style="color:#DCDCAA;">databaseIdMatchesCurrent</span><span style="color:#D4D4D4;">(id, databaseId, </span><span style="color:#569CD6;">this</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">requiredDatabaseId</span><span style="color:#D4D4D4;">)) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">nodeName</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getNode</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">getNodeName</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">SqlCommandType</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">sqlCommandType</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">SqlCommandType</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">valueOf</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">nodeName</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">toUpperCase</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">Locale</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">ENGLISH</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">boolean</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">isSelect</span><span style="color:#D4D4D4;"> = sqlCommandType == </span><span style="color:#9CDCFE;">SqlCommandType</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">SELECT</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">boolean</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">flushCache</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getBooleanAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;flushCache&quot;</span><span style="color:#D4D4D4;">, !isSelect);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">boolean</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">useCache</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getBooleanAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;useCache&quot;</span><span style="color:#D4D4D4;">, isSelect);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">boolean</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">resultOrdered</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getBooleanAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;resultOrdered&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">false</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// Include Fragments before parsing</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">XMLIncludeTransformer</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">includeParser</span><span style="color:#D4D4D4;"> = </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">XMLIncludeTransformer</span><span style="color:#D4D4D4;">(configuration, builderAssistant);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">includeParser</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">applyIncludes</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getNode</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">parameterType</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;parameterType&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">Class</span><span style="color:#D4D4D4;">&lt;</span><span style="color:#569CD6;">?</span><span style="color:#D4D4D4;">&gt; </span><span style="color:#9CDCFE;">parameterTypeClass</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">resolveClass</span><span style="color:#D4D4D4;">(parameterType);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">     * @see XMLLanguageDriver</span></span>
<span class="line"><span style="color:#6A9955;">     * &lt;a href=&quot;http://www.mybatis.org/mybatis-3/zh/dynamic-sql.html&quot;&gt;lang\u5C5E\u6027\u8BF4\u660E&lt;/a&gt;</span></span>
<span class="line"><span style="color:#6A9955;">     * \u83B7\u53D6\u53EF\u63D2\u62D4\u7684\u811A\u672C\u8BED\u8A00 \u9700\u8981\u5B9E\u73B0 LanguageDriver mybatis\u9ED8\u8BA4\u5B9E\u73B0\u65F6XmlLanguageDriver</span></span>
<span class="line"><span style="color:#6A9955;">     */</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">lang</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;lang&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">LanguageDriver</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">langDriver</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">getLanguageDriver</span><span style="color:#D4D4D4;">(lang);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// Parse selectKey after includes and remove them.</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">processSelectKeyNodes</span><span style="color:#D4D4D4;">(id, parameterTypeClass, langDriver);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// Parse the SQL (pre: &lt;selectKey&gt; and &lt;include&gt; were parsed and removed)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">KeyGenerator</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">keyGenerator</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">keyStatementId</span><span style="color:#D4D4D4;"> = id + </span><span style="color:#9CDCFE;">SelectKeyGenerator</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">SELECT_KEY_SUFFIX</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    keyStatementId = </span><span style="color:#9CDCFE;">builderAssistant</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">applyCurrentNamespace</span><span style="color:#D4D4D4;">(keyStatementId, </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">configuration</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">hasKeyGenerator</span><span style="color:#D4D4D4;">(keyStatementId)) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      keyGenerator = </span><span style="color:#9CDCFE;">configuration</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getKeyGenerator</span><span style="color:#D4D4D4;">(keyStatementId);</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      keyGenerator = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getBooleanAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;useGeneratedKeys&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#9CDCFE;">configuration</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">isUseGeneratedKeys</span><span style="color:#D4D4D4;">() &amp;&amp; </span><span style="color:#9CDCFE;">SqlCommandType</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">INSERT</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">equals</span><span style="color:#D4D4D4;">(sqlCommandType))</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#C586C0;">?</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">Jdbc3KeyGenerator</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">INSTANCE</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">:</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">NoKeyGenerator</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">INSTANCE</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#6A9955;">//\u6784\u9020SqlSource\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">SqlSource</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">sqlSource</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">langDriver</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">createSqlSource</span><span style="color:#D4D4D4;">(configuration, context, parameterTypeClass);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">StatementType</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">statementType</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">StatementType</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">valueOf</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;statementType&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">StatementType</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">PREPARED</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">toString</span><span style="color:#D4D4D4;">()));</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">Integer</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">fetchSize</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getIntAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;fetchSize&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">Integer</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">timeout</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getIntAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;timeout&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">parameterMap</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;parameterMap&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">resultType</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;resultType&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">Class</span><span style="color:#D4D4D4;">&lt;</span><span style="color:#569CD6;">?</span><span style="color:#D4D4D4;">&gt; </span><span style="color:#9CDCFE;">resultTypeClass</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">resolveClass</span><span style="color:#D4D4D4;">(resultType);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">resultMap</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;resultMap&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">resultSetType</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;resultSetType&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">ResultSetType</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">resultSetTypeEnum</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">resolveResultSetType</span><span style="color:#D4D4D4;">(resultSetType);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">keyProperty</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;keyProperty&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">keyColumn</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;keyColumn&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">resultSets</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;resultSets&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">builderAssistant</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addMappedStatement</span><span style="color:#D4D4D4;">(id, sqlSource, statementType, sqlCommandType,</span></span>
<span class="line"><span style="color:#D4D4D4;">        fetchSize, timeout, parameterMap, parameterTypeClass, resultMap, resultTypeClass,</span></span>
<span class="line"><span style="color:#D4D4D4;">        resultSetTypeEnum, flushCache, useCache, resultOrdered,</span></span>
<span class="line"><span style="color:#D4D4D4;">        keyGenerator, keyProperty, keyColumn, databaseId, langDriver, resultSets);</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u901A\u8FC7LanguageDriver\u521B\u5EFAsqlsource</p><p>org.apache.ibatis.scripting.xmltags.XMLLanguageDriver#createSqlSource(org.apache.ibatis.session.Configuration, org.apache.ibatis.parsing.XNode, java.lang.Class&lt;?&gt;)</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">@</span><span style="color:#4EC9B0;">Override</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">SqlSource</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">createSqlSource</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">Configuration</span><span style="color:#D4D4D4;"> configuration, </span><span style="color:#4EC9B0;">XNode</span><span style="color:#D4D4D4;"> script, </span><span style="color:#4EC9B0;">Class</span><span style="color:#D4D4D4;">&lt;</span><span style="color:#C586C0;">?</span><span style="color:#D4D4D4;">&gt; parameterType) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">     * \u8FDB\u884C\u52A8\u6001sql\u8BED\u53E5\u7684\u89E3\u6790</span></span>
<span class="line"><span style="color:#6A9955;">     * \u89E3\u6790xml\u4E2D\u5404\u4E2A\u8282\u70B9sql\u90E8\u5206\u7684Builder</span></span>
<span class="line"><span style="color:#6A9955;">     */</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">XMLScriptBuilder</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">builder</span><span style="color:#D4D4D4;"> = </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">XMLScriptBuilder</span><span style="color:#D4D4D4;">(configuration, script, parameterType);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">builder</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">parseScriptNode</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u603B\u7ED3\uFF1A</p><p><img src="`+C+'" alt="sqlsource\u521B\u5EFA\u6D41\u7A0B"></p></li></ul><h3 id="_2-4sqlsession\u6267\u884C\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#_2-4sqlsession\u6267\u884C\u6D41\u7A0B" aria-hidden="true">#</a> 2.4sqlsession\u6267\u884C\u6D41\u7A0B</h3><p><img src="'+p+'" alt="sqlsession\u6267\u884C\u6D41\u7A0B"></p><p><img src="'+u+'" alt="sqlsession\u6267\u884C\u6D41\u7A0B2"></p><h3 id="_2-5\u83B7\u53D6boundsql\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#_2-5\u83B7\u53D6boundsql\u6D41\u7A0B" aria-hidden="true">#</a> 2.5\u83B7\u53D6boundsql\u6D41\u7A0B</h3><p><img src="'+v+'" alt="\u83B7\u53D6boundsql\u6D41\u7A0B"></p><h3 id="_2-6\u53C2\u6570\u6620\u5C04\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#_2-6\u53C2\u6570\u6620\u5C04\u6D41\u7A0B" aria-hidden="true">#</a> 2.6\u53C2\u6570\u6620\u5C04\u6D41\u7A0B</h3><p><img src="'+m+'" alt="\u53C2\u6570\u6620\u5C04\u6D41\u7A0B"></p><h3 id="_2-7\u7ED3\u679C\u96C6\u6620\u5C04\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#_2-7\u7ED3\u679C\u96C6\u6620\u5C04\u6D41\u7A0B" aria-hidden="true">#</a> 2.7\u7ED3\u679C\u96C6\u6620\u5C04\u6D41\u7A0B</h3><p><img src="'+b+'" alt="\u7ED3\u679C\u6620\u5C04\u6D41\u7A0B"></p><h2 id="_3-\u8BBE\u8BA1\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_3-\u8BBE\u8BA1\u6A21\u5F0F" aria-hidden="true">#</a> 3.\u8BBE\u8BA1\u6A21\u5F0F</h2><blockquote><p>https://blog.csdn.net/zhangerqing/article/details/8194653</p></blockquote><ul><li>Builder\u6A21\u5F0F\uFF0C\u4F8B\u5982SqlSessionFactoryBuilder\u3001XMLConfigBuilder\u3001XMLMapperBuilder\u3001XMLStatementBuilder\u3001CacheBuilder\uFF1B</li><li>\u5DE5\u5382\u6A21\u5F0F\uFF0C\u4F8B\u5982SqlSessionFactory1\u3001ObjectFactory\u3001MapperProxyFactory\uFF1B</li><li>\u5355\u4F8B\u6A21\u5F0F\uFF0C\u4F8B\u5982ErrorContext\u548CLogFactory\uFF1B</li><li>\u4EE3\u7406\u6A21\u5F0F\uFF0CMybatis\u5B9E\u73B0\u7684\u6838\u5FC3\uFF0C\u6BD4\u5982MapperProxy\u3001ConnectionLogger\uFF0C\u7528\u7684jdk\u7684\u52A8\u6001\u4EE3\u7406\uFF1B\u8FD8\u6709executor.loader\u5305\u4F7F\u7528\u4E86cglib\u6216\u8005javassist\u8FBE\u5230\u5EF6\u8FDF\u52A0\u8F7D\u7684\u6548\u679C\uFF1B</li><li>\u7EC4\u5408\u6A21\u5F0F\uFF0C\u4F8B\u5982SqlNode\u548C\u5404\u4E2A\u5B50\u7C7BChooseSqlNode\u7B49\uFF1B</li><li>\u6A21\u677F\u65B9\u6CD5\u6A21\u5F0F\uFF0C\u4F8B\u5982BaseExecutor\u548CSimpleExecutor\uFF0C\u8FD8\u6709BaseTypeHandler\u548C\u6240\u6709\u7684\u5B50\u7C7B\u4F8B\u5982IntegerTypeHandler\uFF1B</li><li>\u9002\u914D\u5668\u6A21\u5F0F\uFF0C\u4F8B\u5982Log\u7684Mybatis\u63A5\u53E3\u548C\u5B83\u5BF9jdbc\u3001log4j\u7B49\u5404\u79CD\u65E5\u5FD7\u6846\u67B6\u7684\u9002\u914D\u5B9E\u73B0\uFF1B</li><li>\u88C5\u9970\u8005\u6A21\u5F0F\uFF0C\u4F8B\u5982Cache\u5305\u4E2D\u7684cache.decorators\u5B50\u5305\u4E2D\u7B49\u5404\u4E2A\u88C5\u9970\u8005\u7684\u5B9E\u73B0\uFF1B</li><li>\u8FED\u4EE3\u5668\u6A21\u5F0F\uFF0C\u4F8B\u5982\u8FED\u4EE3\u5668\u6A21\u5F0FPropertyTokenizer\uFF1B</li></ul><h2 id="_4-\u624B\u5199mybaits" tabindex="-1"><a class="header-anchor" href="#_4-\u624B\u5199mybaits" aria-hidden="true">#</a> 4.\u624B\u5199mybaits</h2><h1 id="todo" tabindex="-1"><a class="header-anchor" href="#todo" aria-hidden="true">#</a> TODO...</h1>',32);function k(j,w){const a=c("ExternalLinkIcon");return o(),r("div",null,[E,s("blockquote",null,[s("p",null,[s("a",g,[h,l(a)])])]),F,q,s("blockquote",null,[s("p",null,[s("a",B,[S,l(a)])])]),f,x,_,M,s("blockquote",null,[s("p",null,[s("a",P,[L,l(a)])])]),X])}var T=e(A,[["render",k],["__file","mybatis_analyse.html.vue"]]);export{T as default};
