<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.49">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" type="image/png" sizes="16x16" href="/images/icons/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/icons/favicon-32x32.png"><link rel="manifest" href="/manifest.webmanifest"><meta name="application-name" content="VuePress"><meta name="apple-mobile-web-app-title" content="VuePress"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png"><link rel="mask-icon" href="/images/icons/safari-pinned-tab.svg" color="#3eaf7c"><meta name="msapplication-TileColor" content="#3eaf7c"><meta name="theme-color" content="#3eaf7c"><title>Mybatis源码分析 | lz's blog</title><meta name="description" content="不积跬步无以至千里">
    <link rel="modulepreload" href="/assets/app.2d179ac6.js"><link rel="modulepreload" href="/assets/mybatis_analyse.html.67db7a70.js"><link rel="modulepreload" href="/assets/mybatis_analyse.html.026ce764.js"><link rel="prefetch" href="/assets/index.html.ce922e96.js"><link rel="prefetch" href="/assets/contributing.html.3a411a07.js"><link rel="prefetch" href="/assets/architecture.html.4e6b8544.js"><link rel="prefetch" href="/assets/plugin.html.2478fd40.js"><link rel="prefetch" href="/assets/theme.html.0b332550.js"><link rel="prefetch" href="/assets/ArrayList.html.b1c78bb4.js"><link rel="prefetch" href="/assets/HashMap.html.183c3b82.js"><link rel="prefetch" href="/assets/LinkedList.html.6345d9c4.js"><link rel="prefetch" href="/assets/deploy.html.920f8ab9.js"><link rel="prefetch" href="/assets/design.html.022867f6.js"><link rel="prefetch" href="/assets/docker.html.cf8f042b.js"><link rel="prefetch" href="/assets/jvm.html.b9c03646.js"><link rel="prefetch" href="/assets/linux.html.6d4fd70c.js"><link rel="prefetch" href="/assets/maven.html.61a6d70e.js"><link rel="prefetch" href="/assets/securityManager.html.8a98cf93.js"><link rel="prefetch" href="/assets/dubbo.html.5711a22c.js"><link rel="prefetch" href="/assets/spring_analyse.html.190cb23c.js"><link rel="prefetch" href="/assets/springboot.html.19e6846c.js"><link rel="prefetch" href="/assets/springcloud.html.8e65ac04.js"><link rel="prefetch" href="/assets/zookeeper.html.8965cbc3.js"><link rel="prefetch" href="/assets/elasticsearch.html.b4a652db.js"><link rel="prefetch" href="/assets/mycat.html.efc17ef6.js"><link rel="prefetch" href="/assets/mysql.html.e58b924c.js"><link rel="prefetch" href="/assets/redis.html.c8fd5471.js"><link rel="prefetch" href="/assets/index.html.144e86d9.js"><link rel="prefetch" href="/assets/assets.html.6149a9cd.js"><link rel="prefetch" href="/assets/bundler.html.41d883e3.js"><link rel="prefetch" href="/assets/configuration.html.569fcb10.js"><link rel="prefetch" href="/assets/deployment.html.2e87e1d3.js"><link rel="prefetch" href="/assets/getting-started.html.ee18f05f.js"><link rel="prefetch" href="/assets/i18n.html.4876761d.js"><link rel="prefetch" href="/assets/markdown.html.1608d7fe.js"><link rel="prefetch" href="/assets/migration.html.758299a9.js"><link rel="prefetch" href="/assets/page.html.9eda836b.js"><link rel="prefetch" href="/assets/plugin.html.6f7595db.js"><link rel="prefetch" href="/assets/theme.html.af5fe1f9.js"><link rel="prefetch" href="/assets/cli.html.7cc9ace8.js"><link rel="prefetch" href="/assets/client-api.html.43c5721d.js"><link rel="prefetch" href="/assets/components.html.b203dc2e.js"><link rel="prefetch" href="/assets/config.html.5d675754.js"><link rel="prefetch" href="/assets/frontmatter.html.cb7902b9.js"><link rel="prefetch" href="/assets/node-api.html.e1ac08d3.js"><link rel="prefetch" href="/assets/plugin-api.html.acd6adb1.js"><link rel="prefetch" href="/assets/theme-api.html.dec36e8b.js"><link rel="prefetch" href="/assets/index.html.75cad36a.js"><link rel="prefetch" href="/assets/adding-extra-pages.html.f27ac48d.js"><link rel="prefetch" href="/assets/making-a-theme-extendable.html.01558906.js"><link rel="prefetch" href="/assets/markdown-and-vue-sfc.html.961fdf5e.js"><link rel="prefetch" href="/assets/passing-data-to-client-code.html.ca69bb2e.js"><link rel="prefetch" href="/assets/usage-of-client-config.html.b76cce07.js"><link rel="prefetch" href="/assets/vite.html.d4303ee4.js"><link rel="prefetch" href="/assets/webpack.html.b0d629df.js"><link rel="prefetch" href="/assets/components.html.16fce079.js"><link rel="prefetch" href="/assets/config.html.79325d15.js"><link rel="prefetch" href="/assets/extending.html.d14a33d7.js"><link rel="prefetch" href="/assets/frontmatter.html.c97d0d05.js"><link rel="prefetch" href="/assets/markdown.html.1a13cc02.js"><link rel="prefetch" href="/assets/styles.html.ea86aa59.js"><link rel="prefetch" href="/assets/active-header-links.html.45b9bd02.js"><link rel="prefetch" href="/assets/back-to-top.html.af6ff50c.js"><link rel="prefetch" href="/assets/container.html.bef91a8d.js"><link rel="prefetch" href="/assets/docsearch.html.16f4c15e.js"><link rel="prefetch" href="/assets/external-link-icon.html.76af1764.js"><link rel="prefetch" href="/assets/git.html.247e0ffd.js"><link rel="prefetch" href="/assets/google-analytics.html.9c016e93.js"><link rel="prefetch" href="/assets/medium-zoom.html.1dc25251.js"><link rel="prefetch" href="/assets/nprogress.html.893a0104.js"><link rel="prefetch" href="/assets/palette.html.729169ee.js"><link rel="prefetch" href="/assets/prismjs.html.f6a4ae7c.js"><link rel="prefetch" href="/assets/pwa-popup.html.b3d39037.js"><link rel="prefetch" href="/assets/pwa.html.adb71ea8.js"><link rel="prefetch" href="/assets/register-components.html.de3ea1e4.js"><link rel="prefetch" href="/assets/search.html.cf5783e8.js"><link rel="prefetch" href="/assets/shiki.html.a1abdee1.js"><link rel="prefetch" href="/assets/theme-data.html.c90a70db.js"><link rel="prefetch" href="/assets/toc.html.bbb10448.js"><link rel="prefetch" href="/assets/404.html.265028f6.js"><link rel="prefetch" href="/assets/index.html.f7b63dec.js"><link rel="prefetch" href="/assets/contributing.html.fcaafa92.js"><link rel="prefetch" href="/assets/architecture.html.05debc79.js"><link rel="prefetch" href="/assets/plugin.html.a0cb5d5b.js"><link rel="prefetch" href="/assets/theme.html.69728f0b.js"><link rel="prefetch" href="/assets/ArrayList.html.e25ef4ab.js"><link rel="prefetch" href="/assets/HashMap.html.ca40b73f.js"><link rel="prefetch" href="/assets/LinkedList.html.591b0937.js"><link rel="prefetch" href="/assets/deploy.html.510dc198.js"><link rel="prefetch" href="/assets/design.html.2d9ceaf2.js"><link rel="prefetch" href="/assets/docker.html.664d5f64.js"><link rel="prefetch" href="/assets/jvm.html.98ed9d7f.js"><link rel="prefetch" href="/assets/linux.html.5b144f58.js"><link rel="prefetch" href="/assets/maven.html.ab0caf1a.js"><link rel="prefetch" href="/assets/securityManager.html.bba423da.js"><link rel="prefetch" href="/assets/dubbo.html.8f6fe996.js"><link rel="prefetch" href="/assets/spring_analyse.html.25b362df.js"><link rel="prefetch" href="/assets/springboot.html.89f6a9b4.js"><link rel="prefetch" href="/assets/springcloud.html.bd3c2463.js"><link rel="prefetch" href="/assets/zookeeper.html.53b5dc84.js"><link rel="prefetch" href="/assets/elasticsearch.html.4d9b533d.js"><link rel="prefetch" href="/assets/mycat.html.e8bce3fc.js"><link rel="prefetch" href="/assets/mysql.html.9341c39e.js"><link rel="prefetch" href="/assets/redis.html.ef4e78a8.js"><link rel="prefetch" href="/assets/index.html.db16eed3.js"><link rel="prefetch" href="/assets/assets.html.2314c7eb.js"><link rel="prefetch" href="/assets/bundler.html.24e5be97.js"><link rel="prefetch" href="/assets/configuration.html.259cd78e.js"><link rel="prefetch" href="/assets/deployment.html.b7d3dd68.js"><link rel="prefetch" href="/assets/getting-started.html.fa9442a2.js"><link rel="prefetch" href="/assets/i18n.html.52274ece.js"><link rel="prefetch" href="/assets/markdown.html.05711a31.js"><link rel="prefetch" href="/assets/migration.html.2be0c1c9.js"><link rel="prefetch" href="/assets/page.html.300f104e.js"><link rel="prefetch" href="/assets/plugin.html.385c351b.js"><link rel="prefetch" href="/assets/theme.html.576cac10.js"><link rel="prefetch" href="/assets/cli.html.f9cb9f61.js"><link rel="prefetch" href="/assets/client-api.html.943d4e52.js"><link rel="prefetch" href="/assets/components.html.21454798.js"><link rel="prefetch" href="/assets/config.html.32d4906f.js"><link rel="prefetch" href="/assets/frontmatter.html.4d600b76.js"><link rel="prefetch" href="/assets/node-api.html.96f0e82c.js"><link rel="prefetch" href="/assets/plugin-api.html.df57c385.js"><link rel="prefetch" href="/assets/theme-api.html.40f0e433.js"><link rel="prefetch" href="/assets/index.html.75050212.js"><link rel="prefetch" href="/assets/adding-extra-pages.html.95427f8d.js"><link rel="prefetch" href="/assets/making-a-theme-extendable.html.ccf8a50a.js"><link rel="prefetch" href="/assets/markdown-and-vue-sfc.html.db584977.js"><link rel="prefetch" href="/assets/passing-data-to-client-code.html.82aa0df7.js"><link rel="prefetch" href="/assets/usage-of-client-config.html.c9ad052e.js"><link rel="prefetch" href="/assets/vite.html.27fa01f8.js"><link rel="prefetch" href="/assets/webpack.html.f864ac5e.js"><link rel="prefetch" href="/assets/components.html.d57f6f9c.js"><link rel="prefetch" href="/assets/config.html.83041e14.js"><link rel="prefetch" href="/assets/extending.html.17dc183d.js"><link rel="prefetch" href="/assets/frontmatter.html.1b196089.js"><link rel="prefetch" href="/assets/markdown.html.a51c4b7b.js"><link rel="prefetch" href="/assets/styles.html.2ed7c337.js"><link rel="prefetch" href="/assets/active-header-links.html.fd52a36b.js"><link rel="prefetch" href="/assets/back-to-top.html.c3457ba9.js"><link rel="prefetch" href="/assets/container.html.fefb86b8.js"><link rel="prefetch" href="/assets/docsearch.html.5efe2d39.js"><link rel="prefetch" href="/assets/external-link-icon.html.7a8e229f.js"><link rel="prefetch" href="/assets/git.html.9b12fda6.js"><link rel="prefetch" href="/assets/google-analytics.html.d08ec2de.js"><link rel="prefetch" href="/assets/medium-zoom.html.462f60a6.js"><link rel="prefetch" href="/assets/nprogress.html.87cc8a65.js"><link rel="prefetch" href="/assets/palette.html.2f488465.js"><link rel="prefetch" href="/assets/prismjs.html.e4cc4ad1.js"><link rel="prefetch" href="/assets/pwa-popup.html.b4fb4e5c.js"><link rel="prefetch" href="/assets/pwa.html.08d0a52e.js"><link rel="prefetch" href="/assets/register-components.html.9e785502.js"><link rel="prefetch" href="/assets/search.html.0d386121.js"><link rel="prefetch" href="/assets/shiki.html.7cf16601.js"><link rel="prefetch" href="/assets/theme-data.html.f1478668.js"><link rel="prefetch" href="/assets/toc.html.c3c80b86.js"><link rel="prefetch" href="/assets/404.html.d344f66d.js"><link rel="prefetch" href="/assets/404.14d2f7d4.js"><link rel="prefetch" href="/assets/Layout.32917280.js"><link rel="prefetch" href="/assets/NpmBadge.6b229c37.js">
    <link rel="stylesheet" href="/assets/style.a0deccd5.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="切换侧边栏" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/images/hero.png" alt="lz&#39;s blog"><span class="site-name can-hide">lz&#39;s blog</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/guide/" class="" aria-label="指南"><!--[--><!--]--> 指南 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="基础"><span class="title">基础</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="基础"><span class="title">基础</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>集合</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/basic/ArrayList.html" class="" aria-label="ArrayList"><!--[--><!--]--> ArrayList <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/basic/HashMap.html" class="" aria-label="HashMap"><!--[--><!--]--> HashMap <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/basic/LinkedList.html" class="" aria-label="LinkedList"><!--[--><!--]--> LinkedList <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>其它</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/basic/deploy.html" class="" aria-label="服务器部署"><!--[--><!--]--> 服务器部署 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/basic/design.html" class="" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/basic/jvm.html" class="" aria-label="JVM内存管理"><!--[--><!--]--> JVM内存管理 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/basic/securityManager.html" class="" aria-label="SecurityManager"><!--[--><!--]--> SecurityManager <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/basic/docker.html" class="" aria-label="Docker 使用和各个软件的安装"><!--[--><!--]--> Docker 使用和各个软件的安装 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/basic/linux.html" class="" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/basic/maven.html" class="" aria-label="Maven"><!--[--><!--]--> Maven <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="框架"><span class="title">框架</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="框架"><span class="title">框架</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>常用</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/construct/dubbo.html" class="" aria-label="Dubbo"><!--[--><!--]--> Dubbo <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a aria-current="page" href="/construct/mybatis_analyse.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Mybatis源码分析"><!--[--><!--]--> Mybatis源码分析 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/construct/spring_analyse.html" class="" aria-label="Spring IOC源码分析"><!--[--><!--]--> Spring IOC源码分析 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/construct/springboot.html" class="" aria-label="Spring Boot 入门"><!--[--><!--]--> Spring Boot 入门 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/construct/springcloud.html" class="" aria-label="Spring Cloud 入门"><!--[--><!--]--> Spring Cloud 入门 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/construct/zookeeper.html" class="" aria-label="Zookeeper"><!--[--><!--]--> Zookeeper <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="数据库"><span class="title">数据库</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>常用</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/db/elasticsearch.html" class="" aria-label="ElasticSearch"><!--[--><!--]--> ElasticSearch <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/db/mycat.html" class="" aria-label="Mycat"><!--[--><!--]--> Mycat <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/db/mysql.html" class="" aria-label="MYSQL"><!--[--><!--]--> MYSQL <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/db/redis.html" class="" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="在线文档"><span class="title">在线文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="在线文档"><span class="title">在线文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>前端文档</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="https://cn.vuejs.org/v2/guide/" rel="noopener noreferrer" target="_blank" aria-label="Vue"><!--[--><!--]--> Vue <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://www.antdv.com/docs/vue/introduce-cn/" rel="noopener noreferrer" target="_blank" aria-label="Vue ant design"><!--[--><!--]--> Vue ant design <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://www.kancloud.cn/yunye/axios/234845" rel="noopener noreferrer" target="_blank" aria-label="Axios"><!--[--><!--]--> Axios <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="参考"><span class="title">参考</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="参考"><span class="title">参考</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>VuePress</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/reference/cli.html" class="" aria-label="命令行接口"><!--[--><!--]--> 命令行接口 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/config.html" class="" aria-label="配置"><!--[--><!--]--> 配置 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/frontmatter.html" class="" aria-label="Frontmatter"><!--[--><!--]--> Frontmatter <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/components.html" class="" aria-label="内置组件"><!--[--><!--]--> 内置组件 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin-api.html" class="" aria-label="插件 API"><!--[--><!--]--> 插件 API <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/theme-api.html" class="" aria-label="主题 API"><!--[--><!--]--> 主题 API <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/client-api.html" class="" aria-label="客户端 API"><!--[--><!--]--> 客户端 API <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/node-api.html" class="" aria-label="Node API"><!--[--><!--]--> Node API <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>打包工具</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/reference/bundler/vite.html" class="" aria-label="Vite"><!--[--><!--]--> Vite <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/bundler/webpack.html" class="" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>默认主题</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/reference/default-theme/config.html" class="" aria-label="配置"><!--[--><!--]--> 配置 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/default-theme/frontmatter.html" class="" aria-label="Frontmatter"><!--[--><!--]--> Frontmatter <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/default-theme/components.html" class="" aria-label="内置组件"><!--[--><!--]--> 内置组件 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/default-theme/markdown.html" class="" aria-label="Markdown"><!--[--><!--]--> Markdown <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/default-theme/styles.html" class="" aria-label="样式"><!--[--><!--]--> 样式 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/default-theme/extending.html" class="" aria-label="继承"><!--[--><!--]--> 继承 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="插件"><span class="title">插件</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="插件"><span class="title">插件</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>常用功能</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/reference/plugin/back-to-top.html" class="" aria-label="back-to-top"><!--[--><!--]--> back-to-top <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/container.html" class="" aria-label="container"><!--[--><!--]--> container <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/external-link-icon.html" class="" aria-label="external-link-icon"><!--[--><!--]--> external-link-icon <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/google-analytics.html" class="" aria-label="google-analytics"><!--[--><!--]--> google-analytics <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/medium-zoom.html" class="" aria-label="medium-zoom"><!--[--><!--]--> medium-zoom <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/nprogress.html" class="" aria-label="nprogress"><!--[--><!--]--> nprogress <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/register-components.html" class="" aria-label="register-components"><!--[--><!--]--> register-components <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>内容搜索</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/reference/plugin/docsearch.html" class="" aria-label="docsearch"><!--[--><!--]--> docsearch <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/search.html" class="" aria-label="search"><!--[--><!--]--> search <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>PWA</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/reference/plugin/pwa.html" class="" aria-label="pwa"><!--[--><!--]--> pwa <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/pwa-popup.html" class="" aria-label="pwa-popup"><!--[--><!--]--> pwa-popup <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>语法高亮</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/reference/plugin/prismjs.html" class="" aria-label="prismjs"><!--[--><!--]--> prismjs <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/shiki.html" class="" aria-label="shiki"><!--[--><!--]--> shiki <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>主题开发</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/reference/plugin/active-header-links.html" class="" aria-label="active-header-links"><!--[--><!--]--> active-header-links <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/git.html" class="" aria-label="git"><!--[--><!--]--> git <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/palette.html" class="" aria-label="palette"><!--[--><!--]--> palette <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/theme-data.html" class="" aria-label="theme-data"><!--[--><!--]--> theme-data <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/toc.html" class="" aria-label="toc"><!--[--><!--]--> toc <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="了解更多"><span class="title">了解更多</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="了解更多"><span class="title">了解更多</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>深入</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/advanced/architecture.html" class="" aria-label="架构"><!--[--><!--]--> 架构 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/advanced/plugin.html" class="" aria-label="开发插件"><!--[--><!--]--> 开发插件 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/advanced/theme.html" class="" aria-label="开发主题"><!--[--><!--]--> 开发主题 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/advanced/cookbook/" class="" aria-label="Cookbook"><!--[--><!--]--> Cookbook <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>其他资源</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/contributing.html" class="" aria-label="贡献指南"><!--[--><!--]--> 贡献指南 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://github.com/vuepress/awesome-vuepress" rel="noopener noreferrer" target="_blank" aria-label="Awesome VuePress"><!--[--><!--]--> Awesome VuePress <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="v2.0.0-beta.49"><span class="title">v2.0.0-beta.49</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="v2.0.0-beta.49"><span class="title">v2.0.0-beta.49</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/vuepress/vuepress-next/blob/main/CHANGELOG.md" rel="noopener noreferrer" target="_blank" aria-label="更新日志"><!--[--><!--]--> 更新日志 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://v1.vuepress.vuejs.org/zh/" rel="noopener noreferrer" target="_blank" aria-label="v1.x"><!--[--><!--]--> v1.x <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://v0.vuepress.vuejs.org/zh/" rel="noopener noreferrer" target="_blank" aria-label="v0.x"><!--[--><!--]--> v0.x <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/lonlyz/blog" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="切换颜色模式"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/guide/" class="" aria-label="指南"><!--[--><!--]--> 指南 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="基础"><span class="title">基础</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="基础"><span class="title">基础</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>集合</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/basic/ArrayList.html" class="" aria-label="ArrayList"><!--[--><!--]--> ArrayList <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/basic/HashMap.html" class="" aria-label="HashMap"><!--[--><!--]--> HashMap <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/basic/LinkedList.html" class="" aria-label="LinkedList"><!--[--><!--]--> LinkedList <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>其它</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/basic/deploy.html" class="" aria-label="服务器部署"><!--[--><!--]--> 服务器部署 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/basic/design.html" class="" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/basic/jvm.html" class="" aria-label="JVM内存管理"><!--[--><!--]--> JVM内存管理 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/basic/securityManager.html" class="" aria-label="SecurityManager"><!--[--><!--]--> SecurityManager <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/basic/docker.html" class="" aria-label="Docker 使用和各个软件的安装"><!--[--><!--]--> Docker 使用和各个软件的安装 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/basic/linux.html" class="" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/basic/maven.html" class="" aria-label="Maven"><!--[--><!--]--> Maven <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="框架"><span class="title">框架</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="框架"><span class="title">框架</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>常用</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/construct/dubbo.html" class="" aria-label="Dubbo"><!--[--><!--]--> Dubbo <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a aria-current="page" href="/construct/mybatis_analyse.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Mybatis源码分析"><!--[--><!--]--> Mybatis源码分析 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/construct/spring_analyse.html" class="" aria-label="Spring IOC源码分析"><!--[--><!--]--> Spring IOC源码分析 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/construct/springboot.html" class="" aria-label="Spring Boot 入门"><!--[--><!--]--> Spring Boot 入门 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/construct/springcloud.html" class="" aria-label="Spring Cloud 入门"><!--[--><!--]--> Spring Cloud 入门 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/construct/zookeeper.html" class="" aria-label="Zookeeper"><!--[--><!--]--> Zookeeper <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="数据库"><span class="title">数据库</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>常用</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/db/elasticsearch.html" class="" aria-label="ElasticSearch"><!--[--><!--]--> ElasticSearch <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/db/mycat.html" class="" aria-label="Mycat"><!--[--><!--]--> Mycat <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/db/mysql.html" class="" aria-label="MYSQL"><!--[--><!--]--> MYSQL <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/db/redis.html" class="" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="在线文档"><span class="title">在线文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="在线文档"><span class="title">在线文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>前端文档</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="external-link" href="https://cn.vuejs.org/v2/guide/" rel="noopener noreferrer" target="_blank" aria-label="Vue"><!--[--><!--]--> Vue <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://www.antdv.com/docs/vue/introduce-cn/" rel="noopener noreferrer" target="_blank" aria-label="Vue ant design"><!--[--><!--]--> Vue ant design <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://www.kancloud.cn/yunye/axios/234845" rel="noopener noreferrer" target="_blank" aria-label="Axios"><!--[--><!--]--> Axios <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="参考"><span class="title">参考</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="参考"><span class="title">参考</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>VuePress</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/reference/cli.html" class="" aria-label="命令行接口"><!--[--><!--]--> 命令行接口 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/config.html" class="" aria-label="配置"><!--[--><!--]--> 配置 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/frontmatter.html" class="" aria-label="Frontmatter"><!--[--><!--]--> Frontmatter <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/components.html" class="" aria-label="内置组件"><!--[--><!--]--> 内置组件 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin-api.html" class="" aria-label="插件 API"><!--[--><!--]--> 插件 API <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/theme-api.html" class="" aria-label="主题 API"><!--[--><!--]--> 主题 API <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/client-api.html" class="" aria-label="客户端 API"><!--[--><!--]--> 客户端 API <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/node-api.html" class="" aria-label="Node API"><!--[--><!--]--> Node API <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>打包工具</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/reference/bundler/vite.html" class="" aria-label="Vite"><!--[--><!--]--> Vite <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/bundler/webpack.html" class="" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>默认主题</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/reference/default-theme/config.html" class="" aria-label="配置"><!--[--><!--]--> 配置 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/default-theme/frontmatter.html" class="" aria-label="Frontmatter"><!--[--><!--]--> Frontmatter <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/default-theme/components.html" class="" aria-label="内置组件"><!--[--><!--]--> 内置组件 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/default-theme/markdown.html" class="" aria-label="Markdown"><!--[--><!--]--> Markdown <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/default-theme/styles.html" class="" aria-label="样式"><!--[--><!--]--> 样式 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/default-theme/extending.html" class="" aria-label="继承"><!--[--><!--]--> 继承 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="插件"><span class="title">插件</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="插件"><span class="title">插件</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>常用功能</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/reference/plugin/back-to-top.html" class="" aria-label="back-to-top"><!--[--><!--]--> back-to-top <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/container.html" class="" aria-label="container"><!--[--><!--]--> container <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/external-link-icon.html" class="" aria-label="external-link-icon"><!--[--><!--]--> external-link-icon <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/google-analytics.html" class="" aria-label="google-analytics"><!--[--><!--]--> google-analytics <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/medium-zoom.html" class="" aria-label="medium-zoom"><!--[--><!--]--> medium-zoom <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/nprogress.html" class="" aria-label="nprogress"><!--[--><!--]--> nprogress <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/register-components.html" class="" aria-label="register-components"><!--[--><!--]--> register-components <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>内容搜索</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/reference/plugin/docsearch.html" class="" aria-label="docsearch"><!--[--><!--]--> docsearch <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/search.html" class="" aria-label="search"><!--[--><!--]--> search <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>PWA</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/reference/plugin/pwa.html" class="" aria-label="pwa"><!--[--><!--]--> pwa <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/pwa-popup.html" class="" aria-label="pwa-popup"><!--[--><!--]--> pwa-popup <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>语法高亮</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/reference/plugin/prismjs.html" class="" aria-label="prismjs"><!--[--><!--]--> prismjs <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/shiki.html" class="" aria-label="shiki"><!--[--><!--]--> shiki <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>主题开发</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/reference/plugin/active-header-links.html" class="" aria-label="active-header-links"><!--[--><!--]--> active-header-links <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/git.html" class="" aria-label="git"><!--[--><!--]--> git <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/palette.html" class="" aria-label="palette"><!--[--><!--]--> palette <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/theme-data.html" class="" aria-label="theme-data"><!--[--><!--]--> theme-data <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/reference/plugin/toc.html" class="" aria-label="toc"><!--[--><!--]--> toc <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="了解更多"><span class="title">了解更多</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="了解更多"><span class="title">了解更多</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>深入</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/advanced/architecture.html" class="" aria-label="架构"><!--[--><!--]--> 架构 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/advanced/plugin.html" class="" aria-label="开发插件"><!--[--><!--]--> 开发插件 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/advanced/theme.html" class="" aria-label="开发主题"><!--[--><!--]--> 开发主题 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/advanced/cookbook/" class="" aria-label="Cookbook"><!--[--><!--]--> Cookbook <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>其他资源</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/contributing.html" class="" aria-label="贡献指南"><!--[--><!--]--> 贡献指南 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="external-link" href="https://github.com/vuepress/awesome-vuepress" rel="noopener noreferrer" target="_blank" aria-label="Awesome VuePress"><!--[--><!--]--> Awesome VuePress <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="v2.0.0-beta.49"><span class="title">v2.0.0-beta.49</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="v2.0.0-beta.49"><span class="title">v2.0.0-beta.49</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/vuepress/vuepress-next/blob/main/CHANGELOG.md" rel="noopener noreferrer" target="_blank" aria-label="更新日志"><!--[--><!--]--> 更新日志 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://v1.vuepress.vuejs.org/zh/" rel="noopener noreferrer" target="_blank" aria-label="v1.x"><!--[--><!--]--> v1.x <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://v0.vuepress.vuejs.org/zh/" rel="noopener noreferrer" target="_blank" aria-label="v0.x"><!--[--><!--]--> v0.x <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/lonlyz/blog" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active collapsible">框架 <span class="down arrow"></span></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/construct/dubbo.html" class="sidebar-item" aria-label="Dubbo"><!--[--><!--]--> Dubbo <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/construct/mybatis_analyse.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Mybatis源码分析"><!--[--><!--]--> Mybatis源码分析 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/construct/mybatis_analyse.html#_1-mybatis架构分析" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.mybatis架构分析"><!--[--><!--]--> 1.mybatis架构分析 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/construct/mybatis_analyse.html#_1-1mybatis框架架构图" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1mybatis框架架构图"><!--[--><!--]--> 1.1mybatis框架架构图 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/construct/mybatis_analyse.html#_1-2整体执行流程图" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2整体执行流程图"><!--[--><!--]--> 1.2整体执行流程图 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/construct/mybatis_analyse.html#_1-3sqlsession执行流程图" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.3sqlsession执行流程图"><!--[--><!--]--> 1.3sqlsession执行流程图 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/construct/mybatis_analyse.html#_2-mybatis源码分析" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.mybatis源码分析"><!--[--><!--]--> 2.mybatis源码分析 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/construct/mybatis_analyse.html#_2-1config文件加载流程" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1config文件加载流程"><!--[--><!--]--> 2.1config文件加载流程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/construct/mybatis_analyse.html#_2-2mapper文件加载流程" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2mapper文件加载流程"><!--[--><!--]--> 2.2mapper文件加载流程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/construct/mybatis_analyse.html#_2-3sqlsource创建流程" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3sqlsource创建流程"><!--[--><!--]--> 2.3sqlsource创建流程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/construct/mybatis_analyse.html#_2-4sqlsession执行流程" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.4sqlsession执行流程"><!--[--><!--]--> 2.4sqlsession执行流程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/construct/mybatis_analyse.html#_2-5获取boundsql流程" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.5获取boundsql流程"><!--[--><!--]--> 2.5获取boundsql流程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/construct/mybatis_analyse.html#_2-6参数映射流程" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.6参数映射流程"><!--[--><!--]--> 2.6参数映射流程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/construct/mybatis_analyse.html#_2-7结果集映射流程" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.7结果集映射流程"><!--[--><!--]--> 2.7结果集映射流程 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/construct/mybatis_analyse.html#_3-设计模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.设计模式"><!--[--><!--]--> 3.设计模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/construct/mybatis_analyse.html#_4-手写mybaits" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.手写mybaits"><!--[--><!--]--> 4.手写mybaits <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/construct/spring_analyse.html" class="sidebar-item" aria-label="Spring IOC源码分析"><!--[--><!--]--> Spring IOC源码分析 <!--[--><!--]--></a><!----></li><li><a href="/construct/springboot.html" class="sidebar-item" aria-label="Spring Boot 入门"><!--[--><!--]--> Spring Boot 入门 <!--[--><!--]--></a><!----></li><li><a href="/construct/springcloud.html" class="sidebar-item" aria-label="Spring Cloud 入门"><!--[--><!--]--> Spring Cloud 入门 <!--[--><!--]--></a><!----></li><li><a href="/construct/zookeeper.html" class="sidebar-item" aria-label="Zookeeper"><!--[--><!--]--> Zookeeper <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="mybatis源码分析" tabindex="-1"><a class="header-anchor" href="#mybatis源码分析" aria-hidden="true">#</a> Mybatis源码分析</h1><blockquote><p><a href="https://www.cnblogs.com/angelica-duhurica/category/1489346.html" target="_blank" rel="noopener noreferrer">mybatis源码分析<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p></blockquote><h2 id="_1-mybatis架构分析" tabindex="-1"><a class="header-anchor" href="#_1-mybatis架构分析" aria-hidden="true">#</a> 1.mybatis架构分析</h2><h3 id="_1-1mybatis框架架构图" tabindex="-1"><a class="header-anchor" href="#_1-1mybatis框架架构图" aria-hidden="true">#</a> 1.1mybatis框架架构图</h3><blockquote><p><a href="https://www.cnblogs.com/angelica-duhurica/p/11111821.html" target="_blank" rel="noopener noreferrer">框架架构<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p></blockquote><p><img src="/construct/mybatis/archtecture_diagram.jpg" alt="框架架构图"></p><p>Mybatis的功能架构分为三层：</p><ul><li>API接口层：提供给外部使用的API接口，开发人员通过这些本地的API操纵数据库。接口层一旦收到调用请求就会调用数据处理层进行具体的数据处理。</li><li>数据处理层：负责具体的SQL查找、SQL解析、SQL执行和执行结果映射等。主要目的是根据调用的请求完成一次数据库操作。</li><li>基础支撑层：负责最基础的功能支撑，包括连接管理、事务管理、配置加载和缓存管理，这些都是公用的东西，为上层提供基础支持。</li></ul><h3 id="_1-2整体执行流程图" tabindex="-1"><a class="header-anchor" href="#_1-2整体执行流程图" aria-hidden="true">#</a> 1.2整体执行流程图</h3><blockquote><p><a href="https://www.cnblogs.com/angelica-duhurica/p/11111695.html" target="_blank" rel="noopener noreferrer">执行流程<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p></blockquote><p><img src="/construct/mybatis/excution_diagram.png" alt="执行流程图"></p><p>执行流程：</p><ul><li>入口为SqlMapConfig.xml全局配置文件，配置mybatis的运行环境。此外sql语句的映射文件Mapper.xml，文件中配置了具体执行的sql语句。该文件需要在SqlMapConfig.xml文件中加载。</li><li>通过全局配置文件构造SqlSessionFactory会话工厂。</li><li>通过会话工厂创建SqlSession，对数据库的操作提供基础。</li><li>mybatis底层自定义Executor执行器接口进行数据库的操作，Executor有两个实现，一个是基本执行器，一个是缓存执行器。</li><li>MapppedStatement是mybatis底层的一个对象，包含了mybatis的配置信息和sql映射信息。Mapper.xml文件一个sql标签对应一个MappedStatement对象，sql标签的id是MappedStatement对象的id。</li><li>MapppedStatement对sql执行的输入参数进行定义。</li><li>MapppedStatement对sql执行的结果进行定于。</li></ul><h3 id="_1-3sqlsession执行流程图" tabindex="-1"><a class="header-anchor" href="#_1-3sqlsession执行流程图" aria-hidden="true">#</a> 1.3sqlsession执行流程图</h3><p><img src="/construct/mybatis/sqlsession_excutrion_diagram.png" alt="sqlsession执行流程图"></p><p>小结：</p><p>​ 在SqlSession接口调用的insert/update/delete方法中，所有的操作都交给了Executor来操作。SqlSession接口是Mybatis框架暴露的外部接口，而Executor是内部的实现接口。在Executor的实现中，又是调用StatementHandler来处理的。当然，在调用StatementHandler设置参数时候，需要ParameterHandler来设置相应的参数。</p><h2 id="_2-mybatis源码分析" tabindex="-1"><a class="header-anchor" href="#_2-mybatis源码分析" aria-hidden="true">#</a> 2.mybatis源码分析</h2><h3 id="_2-1config文件加载流程" tabindex="-1"><a class="header-anchor" href="#_2-1config文件加载流程" aria-hidden="true">#</a> 2.1config文件加载流程</h3><ul><li><p>加载mybatis全局配置文件，使用<strong>SqlSessionFactoryBuilder</strong>创建<strong>SqlSessionFactory</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">resource</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&quot;debug/config/mybatis-config.xml&quot;</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#4EC9B0;">Reader</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">reader</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#6A9955;">// 使用java.io.Reader构建</span></span>
<span class="line"><span style="color:#D4D4D4;">reader = </span><span style="color:#9CDCFE;">Resources</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getResourceAsReader</span><span style="color:#D4D4D4;">(resource);</span></span>
<span class="line"><span style="color:#4EC9B0;">SqlSessionFactory</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">sqlMapper</span><span style="color:#D4D4D4;"> = </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">SqlSessionFactoryBuilder</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">build</span><span style="color:#D4D4D4;">(reader);</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>实例化<strong>XMLConfigBuilder</strong>对象传入mybatis的全局配置文件，进行mybatis配置文件的解析</p><p>org.apache.ibatis.session.SqlSessionFactoryBuilder#build(java.io.Reader, java.lang.String, java.util.Properties)</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">SqlSessionFactory</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">build</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">Reader</span><span style="color:#D4D4D4;"> reader, </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> environment, </span><span style="color:#4EC9B0;">Properties</span><span style="color:#D4D4D4;"> properties) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">       * 解析mybatis-config.xml   config节点</span></span>
<span class="line"><span style="color:#6A9955;">       */</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#4EC9B0;">XMLConfigBuilder</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">parser</span><span style="color:#D4D4D4;"> = </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">XMLConfigBuilder</span><span style="color:#D4D4D4;">(reader, environment, properties);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">       * 解析mybatis-config.xml   mapper节点 解析*mapper.xml</span></span>
<span class="line"><span style="color:#6A9955;">       */</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">build</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">parser</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">parse</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">Exception</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">throw</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">ExceptionFactory</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">wrapException</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Error building SqlSession.&quot;</span><span style="color:#D4D4D4;">, e);</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">finally</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">ErrorContext</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">instance</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">reset</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">reader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">close</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">      } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">IOException</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">// Intentionally ignore. Prefer previous error.</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>实例化<strong>XMLConfigBuilder</strong>对象的过程中，创建文档解析器</p><p>org.apache.ibatis.builder.xml.XMLConfigBuilder#XMLConfigBuilder(java.io.Reader, java.lang.String, java.util.Properties)</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">   *</span></span>
<span class="line"><span style="color:#6A9955;">   * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">reader</span><span style="color:#6A9955;"> 配置文件的字符流</span></span>
<span class="line"><span style="color:#6A9955;">   * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">environment</span><span style="color:#6A9955;"> 环境参数</span></span>
<span class="line"><span style="color:#6A9955;">   * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">props</span><span style="color:#6A9955;"> 参数</span></span>
<span class="line"><span style="color:#6A9955;">   */</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">XMLConfigBuilder</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">Reader</span><span style="color:#D4D4D4;"> reader, </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> environment, </span><span style="color:#4EC9B0;">Properties</span><span style="color:#D4D4D4;"> props) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">this</span><span style="color:#D4D4D4;">(</span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">XPathParser</span><span style="color:#D4D4D4;">(reader, </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">, props, </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">XMLMapperEntityResolver</span><span style="color:#D4D4D4;">()), environment, props);</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>org.apache.ibatis.builder.xml.XMLConfigBuilder#XMLConfigBuilder(org.apache.ibatis.parsing.XPathParser, java.lang.String, java.util.Properties)</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">   * 主要是根据mybatis自身需要创建一个文档解析器，然后调用parse将输入input source解析为DOM XML文档并返回。</span></span>
<span class="line"><span style="color:#6A9955;">   * 得到XPathParser实例之后，就调用另一个使用XPathParser作为配置来源的重载构造函数了</span></span>
<span class="line"><span style="color:#6A9955;">   * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">parser</span></span>
<span class="line"><span style="color:#6A9955;">   * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">environment</span></span>
<span class="line"><span style="color:#6A9955;">   * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">props</span></span>
<span class="line"><span style="color:#6A9955;">   */</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">XMLConfigBuilder</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">XPathParser</span><span style="color:#D4D4D4;"> parser, </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> environment, </span><span style="color:#4EC9B0;">Properties</span><span style="color:#D4D4D4;"> props) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">//主要是设置类型别名注册器，以及类型处理器注册器</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">super</span><span style="color:#D4D4D4;">(</span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">Configuration</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">ErrorContext</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">instance</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">resource</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;SQL Mapper Configuration&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">this</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">configuration</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setVariables</span><span style="color:#D4D4D4;">(props);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">this</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">parsed</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">false</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">this</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">environment</span><span style="color:#D4D4D4;"> = environment;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">this</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">parser</span><span style="color:#D4D4D4;"> = parser;</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>XPathParser**使用的createDocument方法来将DOM加载到XPathParser中</p><p>org.apache.ibatis.parsing.XPathParser#XPathParser(java.io.Reader, boolean, java.util.Properties, org.xml.sax.EntityResolver)</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">XPathParser</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">Reader</span><span style="color:#D4D4D4;"> reader, </span><span style="color:#4EC9B0;">boolean</span><span style="color:#D4D4D4;"> validation, </span><span style="color:#4EC9B0;">Properties</span><span style="color:#D4D4D4;"> variables, </span><span style="color:#4EC9B0;">EntityResolver</span><span style="color:#D4D4D4;"> entityResolver) {</span></span>
<span class="line"><span style="color:#D4D4D4;">     </span><span style="color:#6A9955;">// entityResolver  上一步实例的XMLMapperEntityResolver</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">commonConstructor</span><span style="color:#D4D4D4;">(validation, variables, entityResolver);</span></span>
<span class="line"><span style="color:#D4D4D4;">     </span><span style="color:#6A9955;">//加载dom元素到XPathParser</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">this</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">document</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">createDocument</span><span style="color:#D4D4D4;">(</span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">InputSource</span><span style="color:#D4D4D4;">(reader));</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>org.apache.ibatis.parsing.XPathParser#createDocument</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Document</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">createDocument</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">InputSource</span><span style="color:#D4D4D4;"> inputSource) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// important: this must only be called AFTER common constructor</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#4EC9B0;">DocumentBuilderFactory</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">factory</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">DocumentBuilderFactory</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">newInstance</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">factory</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setValidating</span><span style="color:#D4D4D4;">(validation);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">//设置由本工厂创建的解析器是否支持XML命名空间 true 支持 false 不支持</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">factory</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setNamespaceAware</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">false</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">factory</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setIgnoringComments</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// 是否在解析的时候消除空格</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">factory</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setIgnoringElementContentWhitespace</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">false</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">//设置是否将CDATA节点转换为Text节点</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">factory</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setCoalescing</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">false</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">//设置是否展开实体引用节点，这里应该是sql片段引用的关键</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">factory</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setExpandEntityReferences</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#4EC9B0;">DocumentBuilder</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">builder</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">factory</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">newDocumentBuilder</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">//设置解析mybatis xml文档节点的解析器,也就是上面的XMLMapperEntityResolver</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">builder</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setEntityResolver</span><span style="color:#D4D4D4;">(entityResolver);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">builder</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setErrorHandler</span><span style="color:#D4D4D4;">(</span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">ErrorHandler</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">        @</span><span style="color:#4EC9B0;">Override</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">error</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">SAXParseException</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">exception</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">throws</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">SAXException</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#C586C0;">throw</span><span style="color:#D4D4D4;"> exception;</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">        @</span><span style="color:#4EC9B0;">Override</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">fatalError</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">SAXParseException</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">exception</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">throws</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">SAXException</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#C586C0;">throw</span><span style="color:#D4D4D4;"> exception;</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">        @</span><span style="color:#4EC9B0;">Override</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">warning</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">SAXParseException</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">exception</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">throws</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">SAXException</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;">      });</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">//加载完成dom元素</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">builder</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">parse</span><span style="color:#D4D4D4;">(inputSource);</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">Exception</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">throw</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">BuilderException</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Error creating document instance.  Cause: &quot;</span><span style="color:#D4D4D4;"> + e, e);</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>SqlSessionFactoryBuilder</strong>中builder()方法的parser.parse()方法,进行实际的解析全局配置文件</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">SqlSessionFactory</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">build</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">Reader</span><span style="color:#D4D4D4;"> reader, </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> environment, </span><span style="color:#4EC9B0;">Properties</span><span style="color:#D4D4D4;"> properties) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">       * 解析mybatis-config.xml   config节点</span></span>
<span class="line"><span style="color:#6A9955;">       */</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#4EC9B0;">XMLConfigBuilder</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">parser</span><span style="color:#D4D4D4;"> = </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">XMLConfigBuilder</span><span style="color:#D4D4D4;">(reader, environment, properties);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">       * 解析mybatis-config.xml   mapper节点 解析*mapper.xml</span></span>
<span class="line"><span style="color:#6A9955;">       */</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">build</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">parser</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">parse</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">Exception</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">throw</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">ExceptionFactory</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">wrapException</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Error building SqlSession.&quot;</span><span style="color:#D4D4D4;">, e);</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">finally</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">ErrorContext</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">instance</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">reset</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#9CDCFE;">reader</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">close</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">      } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">IOException</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">// Intentionally ignore. Prefer previous error.</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>org.apache.ibatis.builder.xml.XMLConfigBuilder#parse</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;">//真正Configuration构建逻辑</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">Configuration</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">parse</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (parsed) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">throw</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">BuilderException</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Each XMLConfigBuilder can only be used once.&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">    parsed = </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">//mybatis配置文件解析的主流程</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">parseConfiguration</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">parser</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;/configuration&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> configuration;</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>org.apache.ibatis.builder.xml.XMLConfigBuilder#parseConfiguration</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">   * 解析mybatis-config.xml文件</span></span>
<span class="line"><span style="color:#6A9955;">   * </span><span style="color:#569CD6;">@param</span><span style="color:#6A9955;"> </span><span style="color:#9CDCFE;">root</span></span>
<span class="line"><span style="color:#6A9955;">   */</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">parseConfiguration</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">XNode</span><span style="color:#D4D4D4;"> root) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">//issue #117 read properties first</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">propertiesElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;properties&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#4EC9B0;">Properties</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">settings</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">settingsAsProperties</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;settings&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// 加载自定义的vfs jbossvfs defaultvfs</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">loadCustomVfs</span><span style="color:#D4D4D4;">(settings);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">loadCustomLogImpl</span><span style="color:#D4D4D4;">(settings);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">//解析类型别名</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">typeAliasesElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;typeAliases&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">//加载插件</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">pluginElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;plugins&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">       * 每次创建结果对象的新实例时，它都会使用一个对象工厂（ObjectFactory）实例来完成</span></span>
<span class="line"><span style="color:#6A9955;">       *  默认的对象工厂需要做的仅仅是实例化目标类，要么通过默认构造方法，要么在参数映射存在的时候通过参数构造方法来实例化。</span></span>
<span class="line"><span style="color:#6A9955;">       *  如果想覆盖对象工厂的默认行为，则可以通过创建自己的对象工厂来实现</span></span>
<span class="line"><span style="color:#6A9955;">       *  setProperties 方法可以被用来配置 ObjectFactory，在初始化你的 ObjectFactory 实例后，objectFactory元素体中定义的属性会被传递给setProperties方法</span></span>
<span class="line"><span style="color:#6A9955;">       *</span></span>
<span class="line"><span style="color:#6A9955;">       * @see &lt;a href=&#39;http://www.mybatis.org/mybatis-3/zh/configuration.html#objectFactory&#39;&gt;对象工厂（ObjectFactory）&lt;/a&gt;</span></span>
<span class="line"><span style="color:#6A9955;">       */</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">objectFactoryElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;objectFactory&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">       * 对象包装器工厂主要用来包装返回result对象，比如说可以用来设置某些敏感字段脱敏或者加密等。</span></span>
<span class="line"><span style="color:#6A9955;">       * 默认对象包装器工厂是DefaultObjectWrapperFactory，也就是不使用包装器工厂</span></span>
<span class="line"><span style="color:#6A9955;">       */</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">objectWrapperFactoryElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;objectWrapperFactory&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">       * 因为加载配置文件中的各种插件类等等，为了提供更好的灵活性，mybatis支持用户自定义反射工厂，不过总体来说，用的不多，要实现反射工厂，只要实现ReflectorFactory接口即可。</span></span>
<span class="line"><span style="color:#6A9955;">       * 默认的反射工厂是DefaultReflectorFactory。一般来说，使用默认的反射工厂就可以了</span></span>
<span class="line"><span style="color:#6A9955;">       */</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">reflectorFactoryElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;reflectorFactory&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">settingsElement</span><span style="color:#D4D4D4;">(settings);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">// read it after objectFactory and objectWrapperFactory issue #631</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">       * 环境可以说是mybatis-config配置文件中最重要的部分，它类似于spring和maven里面的profile，允许给开发、生产环境同时配置不同的environment，根据不同的环境加载不同的配置，这也是常见的做法，</span></span>
<span class="line"><span style="color:#6A9955;">       * 如果在SqlSessionFactoryBuilder调用期间没有传递使用哪个环境的话，默认会使用一个名为default”的环境。</span></span>
<span class="line"><span style="color:#6A9955;">       * 找到对应的environment之后，就可以加载事务管理器和数据源了。</span></span>
<span class="line"><span style="color:#6A9955;">       * 事务管理器和数据源类型这里都用到了类型别名，JDBC/POOLED都是在mybatis内置提供的，在Configuration构造器执行期间注册到TypeAliasRegister。</span></span>
<span class="line"><span style="color:#6A9955;">       * mybatis内置提供JDBC和MANAGED两种事务管理方式，前者主要用于简单JDBC模式，后者主要用于容器管理事务，一般使用JDBC事务管理方式。</span></span>
<span class="line"><span style="color:#6A9955;">       * mybatis内置提供JNDI、POOLED、UNPOOLED三种数据源工厂，一般情况下使用POOLED数据源。</span></span>
<span class="line"><span style="color:#6A9955;">       */</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">environmentsElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;environments&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">       * MyBatis 会加载不带 databaseId 属性和带有匹配当前数据库 databaseId 属性的所有语句。</span></span>
<span class="line"><span style="color:#6A9955;">       * 如果同时找到带有 databaseId 和不带 databaseId 的相同语句，则后者会被舍弃。</span></span>
<span class="line"><span style="color:#6A9955;">       */</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">databaseIdProviderElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;databaseIdProvider&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">       *无论是 MyBatis 在预处理语句（PreparedStatement）中设置一个参数时，还是从结果集中取出一个值时， 都会用类型处理器将获取的值以合适的方式转换成 Java 类型。</span></span>
<span class="line"><span style="color:#6A9955;">       * mybatis提供了两种方式注册类型处理器，package自动检索方式和显示定义方式。使用自动检索（autodiscovery）功能的时候，只能通过注解方式来指定 JDBC 的类型。</span></span>
<span class="line"><span style="color:#6A9955;">       * 为了简化使用，mybatis在初始化TypeHandlerRegistry期间，自动注册了大部分的常用的类型处理器比如字符串、数字、日期等。对于非标准的类型，用户可以自定义类型处理器来处理。要实现一个自定义类型处理器，只要实现 org.apache.ibatis.type.TypeHandler 接口， 或继承一个实用类 org.apache.ibatis.type.BaseTypeHandler， 并将它映射到一个 JDBC 类型即可。</span></span>
<span class="line"><span style="color:#6A9955;">       * &lt;a href=&#39;https://www.cnblogs.com/zhjh256/p/8512392.html#2.1.11-%E5%8A%A0%E8%BD%BD%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86%E5%99%A8typehandlerelement&#39;&gt;类型处理器&lt;/a&gt;</span></span>
<span class="line"><span style="color:#6A9955;">       */</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">typeHandlerElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;typeHandlers&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">       * &lt;a href=&#39;https://www.cnblogs.com/zhjh256/p/8512392.html#2.1.12-%E5%8A%A0%E8%BD%BDmapper%E6%96%87%E4%BB%B6mapperelement&#39;&gt;加载mapper文件&lt;/a&gt;</span></span>
<span class="line"><span style="color:#6A9955;">       */</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">mapperElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;mappers&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">Exception</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">throw</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">BuilderException</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Error parsing SQL Mapper Configuration. Cause: &quot;</span><span style="color:#D4D4D4;"> + e, e);</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>总结：</p><p><img src="/construct/mybatis/config_load_diagram.png" alt="加载流程图"></p><h3 id="_2-2mapper文件加载流程" tabindex="-1"><a class="header-anchor" href="#_2-2mapper文件加载流程" aria-hidden="true">#</a> 2.2mapper文件加载流程</h3><ul><li><p>解析全局配置文件</p><p>org.apache.ibatis.builder.xml.XMLConfigBuilder#parseConfiguration</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">parseConfiguration</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">XNode</span><span style="color:#D4D4D4;"> root) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">     ...</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">//加载mybatis.config的&lt;mappers&gt;标签</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">mapperElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">root</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;mappers&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">Exception</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">throw</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">BuilderException</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Error parsing SQL Mapper Configuration. Cause: &quot;</span><span style="color:#D4D4D4;"> + e, e);</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>org.apache.ibatis.builder.xml.XMLConfigBuilder#mapperElement</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">mapperElement</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">XNode</span><span style="color:#D4D4D4;"> parent) throws Exception {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (parent != </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">XNode</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">child</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">:</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">parent</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getChildren</span><span style="color:#D4D4D4;">()) {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">         * 如果要同时使用package自动扫描和通过mapper明确指定要加载的mapper，一定要确保package自动扫描的范围不包含明确指定的mapper，</span></span>
<span class="line"><span style="color:#6A9955;">         * 否则在通过package扫描的interface的时候，尝试加载对应xml文件的loadXmlResource()的逻辑中出现判重出错，报org.apache.ibatis.binding.BindingException异常，</span></span>
<span class="line"><span style="color:#6A9955;">         * 即使xml文件中包含的内容和mapper接口中包含的语句不重复也会出错，包括加载mapper接口时自动加载的xml mapper也一样会出错。</span></span>
<span class="line"><span style="color:#6A9955;">         */</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#CE9178;">&quot;package&quot;</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">equals</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">child</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getName</span><span style="color:#D4D4D4;">())) {</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">mapperPackage</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">child</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;name&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#9CDCFE;">configuration</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addMappers</span><span style="color:#D4D4D4;">(mapperPackage);</span></span>
<span class="line"><span style="color:#D4D4D4;">        } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">resource</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">child</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;resource&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">url</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">child</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;url&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">mapperClass</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">child</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;class&quot;</span><span style="color:#D4D4D4;">);     </span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (resource != </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> &amp;&amp; url == </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> &amp;&amp; mapperClass == </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#6A9955;">//mapper标签设置的resource</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">ErrorContext</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">instance</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">resource</span><span style="color:#D4D4D4;">(resource);</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#4EC9B0;">InputStream</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">inputStream</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">Resources</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getResourceAsStream</span><span style="color:#D4D4D4;">(resource);</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#4EC9B0;">XMLMapperBuilder</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">mapperParser</span><span style="color:#D4D4D4;"> = </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">XMLMapperBuilder</span><span style="color:#D4D4D4;">(inputStream, configuration, resource, </span><span style="color:#9CDCFE;">configuration</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getSqlFragments</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">mapperParser</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">parse</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">          } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (resource == </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> &amp;&amp; url != </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> &amp;&amp; mapperClass == </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">              </span><span style="color:#6A9955;">//mapper标签设置的url</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">ErrorContext</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">instance</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">resource</span><span style="color:#D4D4D4;">(url);</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#4EC9B0;">InputStream</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">inputStream</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">Resources</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getUrlAsStream</span><span style="color:#D4D4D4;">(url);</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#4EC9B0;">XMLMapperBuilder</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">mapperParser</span><span style="color:#D4D4D4;"> = </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">XMLMapperBuilder</span><span style="color:#D4D4D4;">(inputStream, configuration, url, </span><span style="color:#9CDCFE;">configuration</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getSqlFragments</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">mapperParser</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">parse</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">          } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (resource == </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> &amp;&amp; url == </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> &amp;&amp; mapperClass != </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">                </span><span style="color:#6A9955;">//mapper标签设置的class，先进行注解方式的加载，然后在加载xml</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#4EC9B0;">Class</span><span style="color:#D4D4D4;">&lt;</span><span style="color:#569CD6;">?</span><span style="color:#D4D4D4;">&gt; </span><span style="color:#9CDCFE;">mapperInterface</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">Resources</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">classForName</span><span style="color:#D4D4D4;">(mapperClass);</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#9CDCFE;">configuration</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addMapper</span><span style="color:#D4D4D4;">(mapperInterface);</span></span>
<span class="line"><span style="color:#D4D4D4;">          } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">            </span><span style="color:#C586C0;">throw</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">BuilderException</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;A mapper element may only specify a url, resource or class, but not more than one.&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">          }</span></span>
<span class="line"><span style="color:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>XMLMapperBuilder</strong>的parse()方法解析mapper.xml</p><p>org.apache.ibatis.builder.xml.XMLMapperBuilder#parse</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">parse</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">//判断configuration对象是否加载xml文件，避免重复加载的问题</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (!</span><span style="color:#9CDCFE;">configuration</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">isResourceLoaded</span><span style="color:#D4D4D4;">(resource)) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">//解析mapper标签</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">configurationElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">parser</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;/mapper&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">configuration</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addLoadedResource</span><span style="color:#D4D4D4;">(resource);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#6A9955;">//将mapperClass添加到configuration中</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">bindMapperForNamespace</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">//解析在configurationElement处理resultMap时，其extends属性指向的父对象还没被处理的resultMap节点</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">parsePendingResultMaps</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">//解析在configurationElement处理&lt;cache-ref&gt;时其指向的对象不存在的&lt;cache&gt;节点---如果&lt;cache-ref&gt;优先于&lt;cache&gt;加载</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">parsePendingCacheRefs</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">//同上，如果&lt;cache&gt;没加载就处理statement时会报异常</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">parsePendingStatements</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>org.apache.ibatis.builder.xml.XMLMapperBuilder#configurationElement</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#569CD6;">private</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">configurationElement</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">XNode</span><span style="color:#D4D4D4;"> context) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">namespace</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;namespace&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (namespace == </span><span style="color:#569CD6;">null</span><span style="color:#D4D4D4;"> || </span><span style="color:#9CDCFE;">namespace</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">equals</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;&quot;</span><span style="color:#D4D4D4;">)) {</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#C586C0;">throw</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">BuilderException</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Mapper&#39;s namespace cannot be empty&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">      }</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">builderAssistant</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">setCurrentNamespace</span><span style="color:#D4D4D4;">(namespace);</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">cacheRefElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;cache-ref&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">cacheElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNode</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;cache&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">parameterMapElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNodes</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;/mapper/parameterMap&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">resultMapElements</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNodes</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;/mapper/resultMap&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">sqlElement</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNodes</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;/mapper/sql&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#6A9955;">//进行sql语句的处理并封装成MappedStatement</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#DCDCAA;">buildStatementFromContext</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">evalNodes</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;select|insert|update|delete&quot;</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">catch</span><span style="color:#D4D4D4;"> (</span><span style="color:#4EC9B0;">Exception</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">throw</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">BuilderException</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Error parsing Mapper XML. The XML location is &#39;&quot;</span><span style="color:#D4D4D4;"> + resource + </span><span style="color:#CE9178;">&quot;&#39;. Cause: &quot;</span><span style="color:#D4D4D4;"> + e, e);</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>总结：</p><p><img src="/construct/mybatis/mapper_load_diagram.png" alt="mapper文件加载过程"></p><h3 id="_2-3sqlsource创建流程" tabindex="-1"><a class="header-anchor" href="#_2-3sqlsource创建流程" aria-hidden="true">#</a> 2.3sqlsource创建流程</h3><ul><li><p>在解析具体sql的XmlStatementBuilder类中org.apache.ibatis.builder.xml.XMLStatementBuilder#parseStatementNode</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">   * 对mapper.xml文件的sql语句进行解析</span></span>
<span class="line"><span style="color:#6A9955;">   */</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">void</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">parseStatementNode</span><span style="color:#D4D4D4;">() {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">id</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;id&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">databaseId</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;databaseId&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (!</span><span style="color:#DCDCAA;">databaseIdMatchesCurrent</span><span style="color:#D4D4D4;">(id, databaseId, </span><span style="color:#569CD6;">this</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">requiredDatabaseId</span><span style="color:#D4D4D4;">)) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">nodeName</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getNode</span><span style="color:#D4D4D4;">().</span><span style="color:#DCDCAA;">getNodeName</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">SqlCommandType</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">sqlCommandType</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">SqlCommandType</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">valueOf</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">nodeName</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">toUpperCase</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">Locale</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">ENGLISH</span><span style="color:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">boolean</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">isSelect</span><span style="color:#D4D4D4;"> = sqlCommandType == </span><span style="color:#9CDCFE;">SqlCommandType</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">SELECT</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">boolean</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">flushCache</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getBooleanAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;flushCache&quot;</span><span style="color:#D4D4D4;">, !isSelect);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">boolean</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">useCache</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getBooleanAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;useCache&quot;</span><span style="color:#D4D4D4;">, isSelect);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">boolean</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">resultOrdered</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getBooleanAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;resultOrdered&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">false</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// Include Fragments before parsing</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">XMLIncludeTransformer</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">includeParser</span><span style="color:#D4D4D4;"> = </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">XMLIncludeTransformer</span><span style="color:#D4D4D4;">(configuration, builderAssistant);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">includeParser</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">applyIncludes</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getNode</span><span style="color:#D4D4D4;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">parameterType</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;parameterType&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">Class</span><span style="color:#D4D4D4;">&lt;</span><span style="color:#569CD6;">?</span><span style="color:#D4D4D4;">&gt; </span><span style="color:#9CDCFE;">parameterTypeClass</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">resolveClass</span><span style="color:#D4D4D4;">(parameterType);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">     * @see XMLLanguageDriver</span></span>
<span class="line"><span style="color:#6A9955;">     * &lt;a href=&quot;http://www.mybatis.org/mybatis-3/zh/dynamic-sql.html&quot;&gt;lang属性说明&lt;/a&gt;</span></span>
<span class="line"><span style="color:#6A9955;">     * 获取可插拔的脚本语言 需要实现 LanguageDriver mybatis默认实现时XmlLanguageDriver</span></span>
<span class="line"><span style="color:#6A9955;">     */</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">lang</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;lang&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">LanguageDriver</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">langDriver</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">getLanguageDriver</span><span style="color:#D4D4D4;">(lang);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// Parse selectKey after includes and remove them.</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#DCDCAA;">processSelectKeyNodes</span><span style="color:#D4D4D4;">(id, parameterTypeClass, langDriver);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// Parse the SQL (pre: &lt;selectKey&gt; and &lt;include&gt; were parsed and removed)</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">KeyGenerator</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">keyGenerator</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">keyStatementId</span><span style="color:#D4D4D4;"> = id + </span><span style="color:#9CDCFE;">SelectKeyGenerator</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">SELECT_KEY_SUFFIX</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    keyStatementId = </span><span style="color:#9CDCFE;">builderAssistant</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">applyCurrentNamespace</span><span style="color:#D4D4D4;">(keyStatementId, </span><span style="color:#569CD6;">true</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">configuration</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">hasKeyGenerator</span><span style="color:#D4D4D4;">(keyStatementId)) {</span></span>
<span class="line"><span style="color:#D4D4D4;">      keyGenerator = </span><span style="color:#9CDCFE;">configuration</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getKeyGenerator</span><span style="color:#D4D4D4;">(keyStatementId);</span></span>
<span class="line"><span style="color:#D4D4D4;">    } </span><span style="color:#C586C0;">else</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;">      keyGenerator = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getBooleanAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;useGeneratedKeys&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#9CDCFE;">configuration</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">isUseGeneratedKeys</span><span style="color:#D4D4D4;">() &amp;&amp; </span><span style="color:#9CDCFE;">SqlCommandType</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">INSERT</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">equals</span><span style="color:#D4D4D4;">(sqlCommandType))</span></span>
<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#C586C0;">?</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">Jdbc3KeyGenerator</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">INSTANCE</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">:</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">NoKeyGenerator</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">INSTANCE</span><span style="color:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">	</span><span style="color:#6A9955;">//构造SqlSource对象</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">SqlSource</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">sqlSource</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">langDriver</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">createSqlSource</span><span style="color:#D4D4D4;">(configuration, context, parameterTypeClass);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">StatementType</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">statementType</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">StatementType</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">valueOf</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;statementType&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">StatementType</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">PREPARED</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">toString</span><span style="color:#D4D4D4;">()));</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">Integer</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">fetchSize</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getIntAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;fetchSize&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">Integer</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">timeout</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getIntAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;timeout&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">parameterMap</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;parameterMap&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">resultType</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;resultType&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">Class</span><span style="color:#D4D4D4;">&lt;</span><span style="color:#569CD6;">?</span><span style="color:#D4D4D4;">&gt; </span><span style="color:#9CDCFE;">resultTypeClass</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">resolveClass</span><span style="color:#D4D4D4;">(resultType);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">resultMap</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;resultMap&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">resultSetType</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;resultSetType&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">ResultSetType</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">resultSetTypeEnum</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">resolveResultSetType</span><span style="color:#D4D4D4;">(resultSetType);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">keyProperty</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;keyProperty&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">keyColumn</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;keyColumn&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">String</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">resultSets</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">getStringAttribute</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;resultSets&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">builderAssistant</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">addMappedStatement</span><span style="color:#D4D4D4;">(id, sqlSource, statementType, sqlCommandType,</span></span>
<span class="line"><span style="color:#D4D4D4;">        fetchSize, timeout, parameterMap, parameterTypeClass, resultMap, resultTypeClass,</span></span>
<span class="line"><span style="color:#D4D4D4;">        resultSetTypeEnum, flushCache, useCache, resultOrdered,</span></span>
<span class="line"><span style="color:#D4D4D4;">        keyGenerator, keyProperty, keyColumn, databaseId, langDriver, resultSets);</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>通过LanguageDriver创建sqlsource</p><p>org.apache.ibatis.scripting.xmltags.XMLLanguageDriver#createSqlSource(org.apache.ibatis.session.Configuration, org.apache.ibatis.parsing.XNode, java.lang.Class&lt;?&gt;)</p><div class="language-java ext-java line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">@</span><span style="color:#4EC9B0;">Override</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">public</span><span style="color:#D4D4D4;"> </span><span style="color:#4EC9B0;">SqlSource</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">createSqlSource</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">Configuration</span><span style="color:#D4D4D4;"> configuration, </span><span style="color:#4EC9B0;">XNode</span><span style="color:#D4D4D4;"> script, </span><span style="color:#4EC9B0;">Class</span><span style="color:#D4D4D4;">&lt;</span><span style="color:#C586C0;">?</span><span style="color:#D4D4D4;">&gt; parameterType) {</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">/**</span></span>
<span class="line"><span style="color:#6A9955;">     * 进行动态sql语句的解析</span></span>
<span class="line"><span style="color:#6A9955;">     * 解析xml中各个节点sql部分的Builder</span></span>
<span class="line"><span style="color:#6A9955;">     */</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#4EC9B0;">XMLScriptBuilder</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">builder</span><span style="color:#D4D4D4;"> = </span><span style="color:#C586C0;">new</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">XMLScriptBuilder</span><span style="color:#D4D4D4;">(configuration, script, parameterType);</span></span>
<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">builder</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">parseScriptNode</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">  }</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>总结：</p><p><img src="/construct/mybatis/sqlsource_create_diagram.png" alt="sqlsource创建流程"></p></li></ul><h3 id="_2-4sqlsession执行流程" tabindex="-1"><a class="header-anchor" href="#_2-4sqlsession执行流程" aria-hidden="true">#</a> 2.4sqlsession执行流程</h3><p><img src="/construct/mybatis/sqlsession_excutrion_diagram.png" alt="sqlsession执行流程"></p><p><img src="/construct/mybatis/sqlsession_excution_diagram_2.png" alt="sqlsession执行流程2"></p><h3 id="_2-5获取boundsql流程" tabindex="-1"><a class="header-anchor" href="#_2-5获取boundsql流程" aria-hidden="true">#</a> 2.5获取boundsql流程</h3><p><img src="/construct/mybatis/get_boundsql_diagram.png" alt="获取boundsql流程"></p><h3 id="_2-6参数映射流程" tabindex="-1"><a class="header-anchor" href="#_2-6参数映射流程" aria-hidden="true">#</a> 2.6参数映射流程</h3><p><img src="/construct/mybatis/param_mapping_diagram.png" alt="参数映射流程"></p><h3 id="_2-7结果集映射流程" tabindex="-1"><a class="header-anchor" href="#_2-7结果集映射流程" aria-hidden="true">#</a> 2.7结果集映射流程</h3><p><img src="/construct/mybatis/result_mapping_diagram.png" alt="结果映射流程"></p><h2 id="_3-设计模式" tabindex="-1"><a class="header-anchor" href="#_3-设计模式" aria-hidden="true">#</a> 3.设计模式</h2><blockquote><p>https://blog.csdn.net/zhangerqing/article/details/8194653</p></blockquote><ul><li>Builder模式，例如SqlSessionFactoryBuilder、XMLConfigBuilder、XMLMapperBuilder、XMLStatementBuilder、CacheBuilder；</li><li>工厂模式，例如SqlSessionFactory1、ObjectFactory、MapperProxyFactory；</li><li>单例模式，例如ErrorContext和LogFactory；</li><li>代理模式，Mybatis实现的核心，比如MapperProxy、ConnectionLogger，用的jdk的动态代理；还有executor.loader包使用了cglib或者javassist达到延迟加载的效果；</li><li>组合模式，例如SqlNode和各个子类ChooseSqlNode等；</li><li>模板方法模式，例如BaseExecutor和SimpleExecutor，还有BaseTypeHandler和所有的子类例如IntegerTypeHandler；</li><li>适配器模式，例如Log的Mybatis接口和它对jdbc、log4j等各种日志框架的适配实现；</li><li>装饰者模式，例如Cache包中的cache.decorators子包中等各个装饰者的实现；</li><li>迭代器模式，例如迭代器模式PropertyTokenizer；</li></ul><h2 id="_4-手写mybaits" tabindex="-1"><a class="header-anchor" href="#_4-手写mybaits" aria-hidden="true">#</a> 4.手写mybaits</h2><h1 id="todo" tabindex="-1"><a class="header-anchor" href="#todo" aria-hidden="true">#</a> TODO...</h1></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/lonlyz/blog/edit/main/docs/construct/mybatis_analyse.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页"><!--[--><!--]--> 在 GitHub 上编辑此页 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 786321279@qq.com">lz</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/construct/dubbo.html" class="" aria-label="Dubbo"><!--[--><!--]--> Dubbo <!--[--><!--]--></a></span><span class="next"><a href="/construct/spring_analyse.html" class="" aria-label="Spring IOC源码分析"><!--[--><!--]--> Spring IOC源码分析 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.2d179ac6.js" defer></script>
  </body>
</html>
